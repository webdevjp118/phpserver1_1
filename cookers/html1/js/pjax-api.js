/*! pjax-api v3.32.0 https://github.com/falsandtru/pjax-api | (c) 2012, falsandtru | (Apache-2.0 AND MPL-2.0) License */
require=function(){return function e(t,n,r){function i(o,c){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!c&&a)return a(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){return i(t[o][1][e]||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}}()({1:[function(e,t,n){},{}],2:[function(e,t,n){arguments[4][1][0].apply(n,arguments)},{dup:1}],3:[function(e,t,n){arguments[4][1][0].apply(n,arguments)},{dup:1}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isArray=n.ObjectValues=n.ObjectSetPrototypeOf=n.ObjectSeal=n.ObjectPreventExtensions=n.ObjectKeys=n.isSealed=n.isFrozen=n.isExtensible=n.ObjectIs=n.ObjectGetPrototypeOf=n.ObjectGetOwnPropertySymbols=n.ObjectGetOwnPropertyNames=n.ObjectGetOwnPropertyDescriptors=n.ObjectGetOwnPropertyDescriptor=n.ObjectFreeze=n.ObjectEntries=n.ObjectDefineProperty=n.ObjectDefineProperties=n.ObjectCreate=n.ObjectAssign=n.toString=n.isEnumerable=n.isPrototypeOf=n.hasOwnProperty=n.SymbolKeyFor=n.SymbolFor=n.parseInt=n.parseFloat=n.isSafeInteger=n.isNaN=n.isInteger=n.isFinite=n.NaN=void 0,n.NaN=Number.NaN,n.isFinite=Number.isFinite,n.isInteger=Number.isInteger,n.isNaN=Number.isNaN,n.isSafeInteger=Number.isSafeInteger,n.parseFloat=Number.parseFloat,n.parseInt=Number.parseInt,n.SymbolFor=Symbol.for,n.SymbolKeyFor=Symbol.keyFor,n.hasOwnProperty=Object.prototype.hasOwnProperty.call.bind(Object.prototype.hasOwnProperty),n.isPrototypeOf=Object.prototype.isPrototypeOf.call.bind(Object.prototype.isPrototypeOf),n.isEnumerable=Object.prototype.propertyIsEnumerable.call.bind(Object.prototype.propertyIsEnumerable),n.toString=Object.prototype.toString.call.bind(Object.prototype.toString),n.ObjectAssign=Object.assign,n.ObjectCreate=Object.create,n.ObjectDefineProperties=Object.defineProperties,n.ObjectDefineProperty=Object.defineProperty,n.ObjectEntries=Object.entries,n.ObjectFreeze=Object.freeze,n.ObjectGetOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,n.ObjectGetOwnPropertyDescriptors=Object.getOwnPropertyDescriptors,n.ObjectGetOwnPropertyNames=Object.getOwnPropertyNames,n.ObjectGetOwnPropertySymbols=Object.getOwnPropertySymbols,n.ObjectGetPrototypeOf=Object.getPrototypeOf,n.ObjectIs=Object.is,n.isExtensible=Object.isExtensible,n.isFrozen=Object.isFrozen,n.isSealed=Object.isSealed,n.ObjectKeys=Object.keys,n.ObjectPreventExtensions=Object.preventExtensions,n.ObjectSeal=Object.seal,n.ObjectSetPrototypeOf=Object.setPrototypeOf,n.ObjectValues=Object.values,n.isArray=Array.isArray},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.join=n.splice=n.push=n.pop=n.unshift=n.shift=n.indexOf=void 0;const r=e("./global"),i=e("./alias");function s(e,t){if(i.isArray(e))for(let n=e.length-1;n>=0;--n)t.unshift(e[n]);else t.unshift(...e);return t}function o(e,t){if(i.isArray(t))for(let n=0;n<t.length;++n)e.push(t[n]);else e.push(...t);return e}function c(e,t,n,...i){if(0===n&&0===i.length)return[];switch(n=n>e.length?e.length:n,t){case 0:switch(n){case 0:return[[],s(i,e)][0];case 1:return 0===e.length?[[],s(i,e)][0]:[[e.shift()],s(i,e)][0];case r.undefined:if(e.length>1||arguments.length>2)break;return 0===e.length?[]:c(e,t,1)}break;case-1:case e.length-1:case r.Infinity:switch(n){case 0:return[[],o(e,i)][0];case 1:return 0===e.length?[[],o(e,i)][0]:[[e.pop()],o(e,i)][0];case r.undefined:if(e.length>1||arguments.length>2)break;return 0===e.length?[]:c(e,t,1)}}return arguments.length>2?e.splice(t,n,...i):e.splice(t)}n.indexOf=function(e,t){return t==t?e.indexOf(t):e.findIndex(e=>e!=e)},n.shift=function(e,t){if(t<0)throw new Error("Unexpected negative number");return t===r.undefined?[e.shift(),e]:[c(e,0,t),e]},n.unshift=s,n.pop=function(e,t){if(t<0)throw new Error("Unexpected negative number");return t===r.undefined?[e,e.pop()]:[e,c(e,e.length-t,t)]},n.push=o,n.splice=c,n.join=function(e,t=""){let n="";for(let r=0;r<e.length;++r)n+=0===r?e[r]:t+e[r];return n}},{"./alias":4,"./global":19}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.template=n.inherit=n.merge=n.extend=n.clone=n.assign=void 0;const r=e("./global"),i=e("./alias"),s=e("./type"),o=e("./array");n.assign=a((e,t,n)=>t[e]=n[e]),n.clone=a((e,t,r)=>{switch(s.type(r[e])){case"Array":return t[e]=r[e].slice();case"Object":switch(s.type(t[e])){case"Object":return t[e]=n.clone(u(r[e]),r[e]);default:return t[e]=r[e]}default:return t[e]=r[e]}}),n.extend=a((e,t,r)=>{switch(s.type(r[e])){case"Array":return t[e]=r[e].slice();case"Object":switch(s.type(t[e])){case"Object":return t[e]=n.extend(t[e],r[e]);default:return t[e]=n.extend(u(r[e]),r[e])}default:return t[e]=r[e]}}),n.merge=a((e,t,r)=>{switch(s.type(r[e])){case"Array":switch(s.type(t[e])){case"Array":return t[e]=o.push(t[e],r[e]);default:return t[e]=r[e].slice()}case"Object":switch(s.type(t[e])){case"Object":return t[e]=n.merge(t[e],r[e]);default:return t[e]=n.merge(u(r[e]),r[e])}default:return t[e]=r[e]}}),n.inherit=a((e,t,r)=>{switch(s.type(r[e])){case"Array":return t[e]=r[e].slice();case"Object":switch(s.type(t[e])){case"Object":return t[e]=c(t,e)?n.inherit(t[e],r[e]):n.inherit(i.ObjectCreate(t[e]),r[e]);default:return t[e]=i.ObjectCreate(r[e])}default:return t[e]=r[e]}});const c="__proto__"in{}?(e,t)=>!("__proto__"in e)||e[t]!==e.__proto__[t]:i.hasOwnProperty;function a(e,t=u){return function(n,...r){let o=s.isPrimitive(n);for(const c of r){const r=s.isPrimitive(c);if(r)n=c,o=r;else{o&&(n=t(c),o=r);const s=i.ObjectKeys(c);for(let t=0;t<s.length;++t)s[t]in{}||e(s[t],n,c)}}return n}}function u(e){switch(s.type(e)){case"Array":return[];case"Object":return e instanceof r.Object?{}:i.ObjectCreate(null);default:return e}}n.template=a},{"./alias":4,"./array":5,"./global":19,"./type":89}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Cache=void 0;const r=e("./global"),i=e("./assign"),s=e("./array");n.Cache=class{constructor(e,t=(()=>r.undefined),n={}){if(this.capacity=e,this.callback=t,this.settings={ignore:{delete:!1,clear:!1},data:{stats:[[],[]],entries:[]}},this.nullish=!1,e>0==0)throw new Error("Spica: Cache: Cache capacity must be greater than 0.");i.extend(this.settings,n);const{stats:o,entries:c}=this.settings.data,a=o[1].slice(0,e),u=o[0].slice(0,e-a.length);if(this.stats={LRU:u,LFU:a},this.store=new r.Map(c),n.data){for(const e of s.push(o[1].slice(a.length),o[0].slice(u.length)))this.store.delete(e);if(this.store.size!==a.length+u.length)throw new Error("Spica: Cache: Size of stats and entries is not matched.");if(![...a,...u].every(e=>this.store.has(e)))throw new Error("Spica: Cache: Keys of stats and entries is not matched.")}}put(e,t){if(this.nullish||t!==r.undefined?r.undefined:this.nullish=!0,this.store.has(e)&&this.access(e))return this.store.set(e,t),!0;const{LRU:n,LFU:i}=this.stats;if(n.length+i.length===this.capacity&&n.length<i.length){const e=i.pop(),t=this.store.get(e);this.store.delete(e),this.callback(e,t)}if(n.unshift(e),this.store.set(e,t),n.length+i.length>this.capacity){const e=n.pop(),t=this.store.get(e);this.store.delete(e),this.callback(e,t)}return!1}set(e,t){return this.put(e,t),t}get(e){const t=this.store.get(e);return(t!==r.undefined||this.nullish&&this.store.has(e))&&this.access(e)?t:r.undefined}has(e){return this.store.has(e)}delete(e){if(!this.store.has(e))return!1;const{LRU:t,LFU:n}=this.stats;for(const r of[n,t]){const t=s.indexOf(r,e);if(-1===t)continue;const n=this.store.get(e);return this.store.delete(s.splice(r,t,1)[0]),!!this.settings.ignore.delete||(this.callback(e,n),!0)}return!1}clear(){const e=this.store;if(this.store=new r.Map,this.stats={LRU:[],LFU:[]},!this.settings.ignore.clear)for(const t of e)this.callback(t[0],t[1])}get size(){return this.store.size}[Symbol.iterator](){return this.store[Symbol.iterator]()}export(){return{stats:[this.stats.LRU.slice(),this.stats.LFU.slice()],entries:[...this]}}inspect(){const{LRU:e,LFU:t}=this.stats;return[e.slice(),t.slice()]}access(e){return this.accessLFU(e)||this.accessLRU(e)}accessLRU(e){const{LRU:t}=this.stats,n=s.indexOf(t,e);if(-1===n)return!1;const{LFU:r}=this.stats;return r.unshift(s.splice(t,n,1)[0]),!0}accessLFU(e){const{LFU:t}=this.stats,n=s.indexOf(t,e);return-1!==n&&(0===n||(t.unshift(s.splice(t,n,1)[0]),!0))}}},{"./array":5,"./assign":6,"./global":19}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Cancellation=void 0;const r=e("./global"),i=e("./promise"),s=e("./exception"),o=e("./monad/maybe"),c=e("./monad/either"),a=e("./noop"),u=Symbol.for("spica/cancellation::internal");n.Cancellation=class extends i.AtomicPromise{constructor(e=[]){var t;super(e=>t=e),this[u]=new l(t);for(const t of e)t.register(this.cancel)}get alive(){return this[u].alive}get canceled(){return this[u].canceled}register(e){return this[u].register(e)}get cancel(){return e=>this[u].cancel(e)}get close(){return e=>this[u].close(e)}get promise(){return e=>this[u].promise(e)}get maybe(){return e=>this[u].maybe(e)}get either(){return e=>this[u].either(e)}};class l{constructor(e){this.resolve=e,this.alive=!0,this.available=!0,this.listeners=new r.Set}get canceled(){return"reason"in this}register(e){return this.alive?(this.listeners.add(t),()=>void this.listeners.delete(t)):(this.canceled&&t(this.reason),a.noop);function t(t){try{e(t)}catch(t){s.causeAsyncException(t)}}}cancel(e){if(this.available){this.available=!1,this.reason=e;for(const t of this.listeners)t(e);this.resolve(this.reason),this.alive=!1}}close(e){this.available&&(this.available=!1,this.resolve(i.AtomicPromise.reject(e)),this.alive=!1)}promise(e){return this.canceled?i.AtomicPromise.reject(this.reason):i.AtomicPromise.resolve(e)}maybe(e){return o.Just(e).bind(e=>this.canceled?o.Nothing:o.Just(e))}either(e){return c.Right(e).bind(e=>this.canceled?c.Left(this.reason):c.Right(e))}}},{"./exception":16,"./global":19,"./monad/either":27,"./monad/maybe":31,"./noop":81,"./promise":83}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Channel=void 0;const r=e("./promise"),i=e("./future"),s=r.AtomicPromise.resolve(),o=()=>r.AtomicPromise.reject(new Error("Spica: Channel: Closed.")),c=Symbol.for("spica/channel::internal");n.Channel=class{constructor(e=0){this[c]=new a(e)}get alive(){return this[c].alive}close(e){var t,n;if(!this.alive)return;const i=this[c],{buffer:s,producers:a,consumers:u}=i;i.alive=!1;for(let e=0;a[e]||u[e];++e)null===(t=a[e])||void 0===t||t.bind(o()),null===(n=u[e])||void 0===n||n.bind(o());u.splice(0,u.length),e?r.AtomicPromise.all([...s.splice(0,s.length),...a.splice(0,a.length)]).then(e):(s.splice(0,s.length),a.splice(0,a.length))}put(e){if(!this.alive)return o();const{size:t,buffer:n,producers:r,consumers:a}=this[c];switch(!0){case n.length<t:case a.length>0:return n.push(e),a.length>0&&a.shift().bind(n.shift()),s;default:return r[r.push(new i.AtomicFuture)-1].then(()=>this.put(e))}}take(){if(!this.alive)return o();const{buffer:e,producers:t,consumers:n}=this[c];switch(!0){case e.length>0:const s=e.shift();return t.length>0&&t.shift().bind(),r.AtomicPromise.resolve(s);case t.length>0:const o=n[n.push(new i.AtomicFuture)-1];return t.shift().bind(),o.then();default:return n[n.push(new i.AtomicFuture)-1].then()}}async*[Symbol.asyncIterator](){try{for(;this.alive;)yield this.take()}catch(e){if(this.alive)throw e}}};class a{constructor(e=0){this.size=e,this.alive=!0,this.buffer=[],this.producers=[],this.consumers=[]}}},{"./future":18,"./promise":83}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.tick=void 0;const r=e("./global"),i=e("./exception");let s=[],o=[],c=0;const a=Promise.resolve();function u(){const e=c;[c,s,o]=[0,o,s];for(let t=0;t<e;++t)try{o[t](),o[t]=r.undefined}catch(e){i.causeAsyncException(e)}o.length>1e3&&e<.5*o.length&&o.splice(.9*o.length|0,o.length)}n.tick=function(e){0===c&&a.then(u),c++===s.length?s.push(e):s[c-1]=e}},{"./exception":16,"./global":19}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.never=n.wait=n.clock=void 0;const r=e("./global"),i=e("./promise");var s=e("./clock.tick");Object.defineProperty(n,"tick",{enumerable:!0,get:function(){return s.tick}}),n.clock=Promise.resolve(void 0),n.wait=function(e){return 0===e?i.AtomicPromise.resolve(n.clock):new i.AtomicPromise(t=>void r.setTimeout(t,e))},n.never=new class e extends i.AtomicPromise{static get[Symbol.species](){return e}constructor(){super(()=>void 0)}then(){return this}catch(){return this}finally(){return this}}},{"./clock.tick":10,"./global":19,"./promise":83}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Copropagator=void 0;const r=e("./global"),i=e("./alias"),s=e("./coroutine"),o=e("./promise"),c=e("./clock");n.Copropagator=class extends s.Coroutine{constructor(e,t=(e=>e[0]),n){super(async function*(){return this.then(t=>{for(const n of e)n[s.Coroutine.exit](t)},t=>{const n=o.AtomicPromise.reject(t);for(const t of e)t[s.Coroutine.exit](n)}),function e(t,n){const s=i.isArray(t)?t:[...t];return o.AtomicPromise.all(s).then(o=>{const c=i.isArray(t)?t:[...t],a=c.length===s.length&&c.every((e,t)=>c[t]===s[t]);if(!n&&a)return o;n=n||new r.Map;for(let e=0;e<o.length;++e)n.set(s[e],o[e]);return a?[...n.values()]:e(c,n)})}(e).then(e=>0===e.length?void this[s.Coroutine.terminate](new r.Error("Spica: Copropagator: No result.")):void this[s.Coroutine.exit](t(e)),e=>void this[s.Coroutine.terminate](e)),c.never},{delay:!1,...n})}}},{"./alias":4,"./clock":11,"./coroutine":13,"./global":19,"./promise":83}],13:[function(e,t,n){"use strict";var r,i;Object.defineProperty(n,"__esModule",{value:!0}),n.isCoroutine=n.Coroutine=void 0;const s=e("./global"),o=e("./alias"),c=e("./promise"),a=e("./future"),u=e("./channel"),l=e("./assign"),h=e("./clock"),d=e("./exception"),p=e("./noop"),f=Symbol.for("spica/Coroutine.alive"),m=Symbol.for("spica/Coroutine.init"),v=Symbol.for("spica/Coroutine.exit"),b=Symbol.for("spica/Coroutine.terminate"),y=Symbol.for("spica/Coroutine.port"),g=Symbol.for("spica/coroutine::internal");class w extends c.AtomicPromise{constructor(e,t={}){var n;super(e=>n=e),this[r]=new q(this),this[g]=new S(t);let i=0;this[w.init]=(async()=>{const t=this[g];if(!t.alive)return;if(0!==i)return;let n=p.noop;try{const r=e.call(this);for(;t.alive;){const[[e,o]]=1==++i?[[s.undefined,p.noop]]:await s.Promise.all([t.settings.size<0?[s.undefined,p.noop]:t.sendBuffer.take(),s.Promise.all([t.settings.resume(),t.settings.interval>0?h.wait(t.settings.interval):s.undefined])]);if(n=o,!t.alive)break;const c=await r.next(e);if(c.done)return t.alive=!1,n({...c}),t.recvBuffer.put({...c}),void t.result.bind(c);n({...c}),await t.recvBuffer.put({...c})}n(c.AtomicPromise.reject(new s.Error("Spica: Coroutine: Canceled.")))}catch(e){n(c.AtomicPromise.reject(e)),this[w.terminate](e)}});const a=this[g];if(n(a.result.then(({value:e})=>e)),a.settings.trigger!==s.undefined)for(const e of s.Array().concat(a.settings.trigger))if(!(e in this&&this.hasOwnProperty(e)))if(e in this)o.ObjectDefineProperty(this,e,{set(t){delete this[e],this[e]=t,this[m]()},get(){return delete this[e],this[m](),this[e]},enumerable:!0,configurable:!0});else{const t=o.ObjectGetOwnPropertyDescriptor(this,e)||{value:this[e],enumerable:!0,configurable:!0,writable:!0};o.ObjectDefineProperty(this,e,{set(n){o.ObjectDefineProperty(this,e,{...t,value:n}),this[m]()},get(){return this[e]},enumerable:!0,configurable:!0})}this[g].settings.run&&(this[g].settings.delay?h.tick(this[w.init]):this[w.init]())}get[f](){return this[g].alive}[v](e){this[g].alive&&c.AtomicPromise.resolve(e).then(e=>{const t=this[g];t.alive&&(t.alive=!1,t.recvBuffer.put({value:s.undefined,done:!0}),t.result.bind({value:e}))},e=>{const t=this[g];t.alive&&(t.alive=!1,t.recvBuffer.put({value:s.undefined,done:!0}),t.result.bind(c.AtomicPromise.reject(e)))})}[b](e){return this[v](c.AtomicPromise.reject(e))}async*[Symbol.asyncIterator](){const e=this[g],t=this[w.port];for(;e.alive;){const e=await t.recv();if(e.done)return e.value;yield e.value}return this}}n.Coroutine=w,r=y,w.alive=f,w.init=m,w.exit=v,w.terminate=b,w.port=y;class S{constructor(e){this.opts=e,this.settings=l.extend({run:!0,delay:!0,size:-1,interval:0,resume:()=>s.undefined,trigger:s.undefined},this.opts),this.alive=!0,this.reception=0,this.sendBuffer=this.settings.size>=0?new u.Channel(this.settings.size):s.undefined,this.recvBuffer=this.settings.size>=0?new u.Channel(0):new _,this.result=new a.AtomicFuture,this.result.finally(()=>{this.sendBuffer.close(e=>{for(;e.length>0;){const[,t]=e.shift();try{t(c.AtomicPromise.reject(new s.Error("Spica: Coroutine: Canceled.")))}catch(e){d.causeAsyncException(e)}}}),this.recvBuffer.close()})}}class q{constructor(e){this[g]={co:e}}ask(e){const t=this[g].co[g];if(!t.alive)return c.AtomicPromise.reject(new s.Error("Spica: Coroutine: Canceled."));if(t.settings.size<0)return c.AtomicPromise.reject(new s.Error("Spica: Coroutine: Overflowed."));t.settings.size>=0&&0===t.reception&&++t.reception&&t.recvBuffer.take();const n=new a.Future;return t.sendBuffer.put([e,n.bind]),++t.reception,s.Promise.all([n,t.recvBuffer.take()]).then(([e])=>e.done?t.result.then(({value:t})=>({...e,value:t})):{...e})}recv(){const e=this[g].co[g];return e.alive?(++e.reception,s.Promise.resolve(e.recvBuffer.take()).then(t=>t.done?e.result.then(({value:e})=>({...t,value:e})):{...t})):c.AtomicPromise.reject(new s.Error("Spica: Coroutine: Canceled."))}send(e){const t=this[g].co[g];if(!t.alive)return c.AtomicPromise.reject(new s.Error("Spica: Coroutine: Canceled."));if(t.settings.size<0)return c.AtomicPromise.reject(new s.Error("Spica: Coroutine: Overflowed."));t.settings.size>=0&&0===t.reception&&++t.reception&&t.recvBuffer.take();const n=new a.Future;return s.Promise.resolve(t.sendBuffer.put([e,n.bind]))}connect(e){const t=this[g].co[g];return t.alive?(async()=>{t.settings.size>=0&&0===t.reception&&++t.reception&&t.recvBuffer.take();const n=e.call(this[g].co);let r;for(;;){const e=await n.next(r);if(e.done)return e.value;r=(await this.ask(e.value)).value}})():c.AtomicPromise.reject(new s.Error("Spica: Coroutine: Canceled."))}}n.isCoroutine=function(e){return"object"==typeof e&&null!==e&&"function"==typeof e.constructor&&"symbol"==typeof e.constructor.alive&&"boolean"==typeof e[e.constructor.alive]&&"symbol"==typeof e.constructor.init&&"function"==typeof e[e.constructor.init]&&"symbol"==typeof e.constructor.exit&&"function"==typeof e[e.constructor.exit]&&"symbol"==typeof e.constructor.terminate&&"function"==typeof e[e.constructor.terminate]&&"symbol"==typeof e.constructor.port&&"object"==typeof e[e.constructor.port]};class _{constructor(){this[i]=new _.Internal}get alive(){return this[g].alive}close(e){var t;if(!this.alive)return;const n=this[g],{consumers:r}=n;n.alive=!1;for(let e=0;r[e];++e)null===(t=r[e])||void 0===t||t.bind(_.fail());r.splice(0,r.length),e&&e([])}put(e){if(!this.alive)return _.fail();const{consumers:t}=this[g];for(;t.length>0;)t.shift().bind(e);return _.success}take(){if(!this.alive)return _.fail();const{consumers:e}=this[g];return e[e.push(new a.AtomicFuture)-1].then()}}i=g,function(e){e.success=c.AtomicPromise.resolve(),e.fail=(()=>c.AtomicPromise.reject(new s.Error("Spica: Channel: Closed.")));e.Internal=class{constructor(){this.alive=!0,this.consumers=[]}}}(_||(_={}))},{"./alias":4,"./assign":6,"./channel":9,"./clock":11,"./exception":16,"./future":18,"./global":19,"./noop":81,"./promise":83}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.uncurry=n.curry=void 0;const r=e("./global"),i=e("./array");n.curry=(e=>(function e(t,n,...i){let s;return i.length<n?(...o)=>e(s=s||i.length&&t.bind(r.undefined,...i)||t,n-i.length,...o):t(...i)})(e,e.length)),n.uncurry=(e=>(function e(t){const n=t.length;return(...r)=>0===n||r.length<2||r.length<=n?t(...r):e(t(...i.shift(r,n)[0]))(...r)})(e))},{"./array":5,"./global":19}],15:[function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./monad/either"),n)},{"./monad/either":27}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.causeAsyncException=void 0,n.causeAsyncException=function(e){Promise.reject(e)}},{}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.flip=void 0,n.flip=function(e){return e.length>1?(t,n)=>e(n,t):(t,...n)=>0===n.length?n=>e(n)(t):e(n[0])(t)}},{}],18:[function(e,t,n){"use strict";var r,i;Object.defineProperty(n,"__esModule",{value:!0}),n.AtomicFuture=n.Future=void 0;const s=e("./global"),o=e("./promise"),c=Symbol.for("spica/promise::internal");n.Future=class{constructor(e=!0){this[Symbol.toStringTag]="Promise",this[r]=new o.Internal,this.bind=(t=>{const n=this[c];if(!n.isPending&&!e)return this;if(!n.isPending)throw new Error("Spica: Future: Cannot rebind a value.");return n.resolve(t),n.resume(),this})}static get[Symbol.species](){return s.Promise}then(e,t){return new s.Promise((n,r)=>this[c].then(e,t,n,r))}catch(e){return this.then(s.undefined,e)}finally(e){return this.then(e,e).then(()=>this)}},r=c;n.AtomicFuture=class{constructor(e=!0){this[Symbol.toStringTag]="Promise",this[i]=new o.Internal,this.bind=(t=>{if(!this[c].isPending&&!e)return this;if(!this[c].isPending)throw new Error("Spica: AtomicFuture: Cannot rebind a value.");return this[c].resolve(t),this[c].resume(),this})}static get[Symbol.species](){return o.AtomicPromise}then(e,t){return new o.AtomicPromise((n,r)=>this[c].then(e,t,n,r))}catch(e){return this.then(s.undefined,e)}finally(e){return this.then(e,e).then(()=>this)}},i=c},{"./global":19,"./promise":83}],19:[function(e,t,n){"use strict";const r="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||Function("return this")();r.global=r,t.exports=r},{}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.compose=void 0,n.compose=function(e,...t){return t.reduce((e,t)=>(Object.getOwnPropertyNames(t.prototype).filter(t=>!(t in e.prototype)).forEach(n=>e.prototype[n]=t.prototype[n]),Object.getOwnPropertyNames(t).filter(t=>!(t in e)).forEach(n=>e[n]=t[n]),e),e)}},{}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HList=void 0,n.HList=function(...e){return 0===e.length?r:e.reduceRight((e,t)=>e.add(t),r)};const r=new class{constructor(){this.TYPE}add(e){return new i(e,this)}unfold(e){return this.add(e())}tuple(){return[]}};class i{constructor(e,t){this.head=e,this.tail=t,this.TYPE}add(e){return new i(e,this)}modify(e){return this.tail.add(e(this.head))}fold(e){return this.tail.modify(t=>e(this.head,t))}unfold(e){return this.add(e(this.head))}reverse(){return this.tuple().reverse()}tuple(){const e=this.tail.tuple();return e.unshift(this.head),e}}},{}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MList=n.List=void 0;const r=e("./global");function i(...e){let t=new s(r.undefined,r.undefined);for(let n=e.length-1;n>=0;--n)t=t.add(e[n]);return t}n.List=i;class s{constructor(e,t){this.head=e,this.tail=t}append(e){return this.replaceWith(e,i()).tail}add(e){return new s(e,this)}foldl(e,t){for(let n=this;n.tail;n=n.tail)t=e(t,n.head);return t}foldr(e,t){for(let n=this.reverse();n.tail;n=n.tail)t=e(n.head,t);return t}map(e){const t=i();return this.foldl((t,n)=>t.append(e(n)),t),t}replaceWith(e,t){return this.head=e,this.tail=t,this}reverse(){return this.foldl((e,t)=>e.add(t),i())}get length(){return this.foldl(e=>e+1,0)}*[Symbol.iterator](){for(let e=this;e.tail;e=e.tail)yield e.head}}function o(...e){let t=new c(r.undefined,r.undefined);for(let n=e.length-1;n>=0;--n)t=t.add(e[n]);return t}n.MList=o;class c{constructor(e,t){this.head=e,this.tail=t}take(e){if(0===e)return o();let t=this;for(let n=0;n+1<e&&t.tail;++n,t=t.tail);const n=t.tail;t.tail&&t.replaceWith(t.head,o());const r=new c(this.head,this.tail);return this.tail&&this.replaceWith(null==n?void 0:n.head,null==n?void 0:n.tail),r}prepend(e){return this.replaceWith(e,new c(this.head,this.tail))}append(e){return this.replaceWith(e,o()).tail}replace(e,t,n){const r=e.take(t),{head:i,tail:s}=e;if(null==n?void 0:n.tail)for(e.replaceWith(n.head,n.tail);e.tail;e=e.tail);return e.replaceWith(i,s),r}splice(e,t=0,n){let r=this;for(let t=0;t<e&&r.tail;++t,r=r.tail);return this.replace(r,t,n)}interleave(e,t,n){let r=this,i=0;for(;!e(r.head,r.tail?i:-1);++i,r=r.tail)if(!r.tail)return;return this.replace(r,t,n)}convert(e){for(let t=this;t.tail;t=t.tail)t.replaceWith(e(t.head),t.tail);return this}clear(){return this.replaceWith(r.undefined,r.undefined)}freeze(){const e=i();for(let t=e,n=this;n.tail;n=n.tail)t=t.append(n.head);return e}add(e){return new c(e,this)}foldl(e,t){for(let n=this;n.tail;n=n.tail)t=e(t,n.head);return t}foldr(e,t){for(let n=this.reverse();n.tail;n=n.tail)t=e(n.head,t);return t}map(e){const t=o();return this.foldl((t,n)=>t.append(e(n)),t),t}replaceWith(e,t){return this.head=e,this.tail=t,this}reverse(){if(!this.tail)return this;for(let e,t=o(),n=this;;){if(e=n.tail,n.replaceWith(n.head,t),!e.tail)return n;t=n,n=e}}get length(){return this.foldl(e=>e+1,0)}*[Symbol.iterator](){for(let e=this;e.tail;e=e.tail)yield e.head}}},{"./global":19}],23:[function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./monad/maybe"),n)},{"./monad/maybe":31}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.memoize=void 0;const r=e("./global");n.memoize=function e(t,n=((...e)=>e[0]),i){if("object"==typeof n)return e(t,r.undefined,n);if(i===r.undefined)return e(t,n,new r.Map);let s=!1;return(...e)=>{const o=n(...e);let c=i.get(o);return c!==r.undefined||s&&i.has(o)?c:(c=t(...e),s=s||c===r.undefined,i.set(o,c),c)}}},{"./global":19}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Applicative=void 0;const r=e("./functor"),i=e("../curry");class s extends r.Functor{}n.Applicative=s,function(e){e.ap=function e(t,n){return n?t.bind(e=>n.fmap(i.curry(e))):n=>e(t,n)}}(s=n.Applicative||(n.Applicative={}))},{"../curry":14,"./functor":28}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Right=n.Left=n.Either=void 0;const r=e("./monad"),i=e("../promise");class s extends r.Monad{constructor(e){super(e),this.EITHER}fmap(e){return this.bind(t=>new c(e(t)))}ap(e){return s.ap(this,e)}bind(e){return new s(()=>{const t=this.evaluate();if(t instanceof o)return t;if(t instanceof c)return e(t.extract());if(t instanceof s)return t.bind(e);throw new TypeError(`Spica: Either: Invalid monad value.\n\t${t}`)})}join(){return this.bind(e=>e)}extract(e,t){return t?this.fmap(t).extract(e):this.evaluate().extract(e)}static do(e){const t=e();let n;for(;;){const{value:e,done:r}=t.next(n);if(r)return e;const i=e.extract(()=>void 0,e=>[e]);if(!i)return e;n=i[0]}}}n.Either=s,function(e){function t(e){return new c(e)}e.pure=t,e.Return=t,e.sequence=function(t){return t instanceof e?t.extract(e=>i.AtomicPromise.resolve(new o(e)),t=>i.AtomicPromise.resolve(t).then(e.Return)):t.reduce((e,t)=>e.bind(e=>t.fmap(t=>[...e,t])),e.Return([]))}}(s=n.Either||(n.Either={}));class o extends s{constructor(e){super(a),this.a=e,this.LEFT}bind(e){return this}extract(e){if(!e)throw this.a;return e(this.a)}}n.Left=o;class c extends s{constructor(e){super(a),this.b=e,this.RIGHT}bind(e){return new s(()=>e(this.extract()))}extract(e,t){return t?t(this.b):this.b}}function a(){throw new Error("Spica: Either: Invalid thunk call.")}n.Right=c},{"../promise":83,"./monad":32}],27:[function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.Right=n.Left=n.Either=void 0;const o=s(e("./either.impl"));n.Either=class extends o.Either{constructor(){super(()=>void 0)}},n.Left=function(e){return new o.Left(e)},n.Right=function(e){return new o.Right(e)}},{"./either.impl":26}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Functor=void 0;const r=e("./lazy");class i extends r.Lazy{}n.Functor=i,function(e){e.fmap=function(e,t){return t?e.fmap(t):t=>e.fmap(t)}}(i=n.Functor||(n.Functor={}))},{"./lazy":29}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Lazy=void 0;n.Lazy=class{constructor(e){this.thunk=e}evaluate(){return this.memory_=this.memory_||this.thunk()}}},{}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Nothing=n.Just=n.Maybe=void 0;const r=e("./monadplus"),i=e("../promise");class s extends r.MonadPlus{constructor(e){super(e),this.MAYBE}fmap(e){return this.bind(t=>new o(e(t)))}ap(e){return s.ap(this,e)}bind(e){return new s(()=>{const t=this.evaluate();if(t instanceof o)return e(t.extract());if(t instanceof c)return t;if(t instanceof s)return t.bind(e);throw new TypeError(`Spica: Maybe: Invalid monad value.\n\t${t}`)})}guard(e){return e?this:s.mzero}join(){return this.bind(e=>e)}extract(e,t){return t?this.fmap(t).extract(e):this.evaluate().extract(e)}static do(e){const t=e();let n;for(;;){const{value:e,done:r}=t.next(n);if(r)return e;const i=e.extract(()=>void 0,e=>[e]);if(!i)return e;n=i[0]}}}n.Maybe=s,function(e){function t(e){return new o(e)}e.pure=t,e.Return=t,e.sequence=function(t){return t instanceof e?t.extract(()=>i.AtomicPromise.resolve(e.mzero),t=>i.AtomicPromise.resolve(t).then(e.Return)):t.reduce((e,t)=>e.bind(e=>t.fmap(t=>[...e,t])),e.Return([]))}}(s=n.Maybe||(n.Maybe={}));class o extends s{constructor(e){super(a),this.a=e,this.JUST}bind(e){return new s(()=>e(this.extract()))}extract(e,t){return t?t(this.a):this.a}}n.Just=o;class c extends s{constructor(){super(a),this.NOTHING}bind(e){return this}extract(e){if(!e)throw void 0;return e()}}function a(){throw new Error("Spica: Maybe: Invalid thunk call.")}n.Nothing=c,function(e){e.mzero=new c,e.mplus=function(t,n){return new e(()=>t.fmap(()=>t).extract(()=>n))}}(s=n.Maybe||(n.Maybe={}))},{"../promise":83,"./monadplus":33}],31:[function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.Nothing=n.Just=n.Maybe=void 0;const o=s(e("./maybe.impl"));n.Maybe=class extends o.Maybe{constructor(){super(()=>void 0)}},n.Just=function(e){return new o.Just(e)},n.Nothing=o.Maybe.mzero},{"./maybe.impl":30}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Monad=void 0;const r=e("./applicative");class i extends r.Applicative{}n.Monad=i,function(e){e.bind=function e(t,n){return n?t.bind(n):n=>e(t,n)}}(i=n.Monad||(n.Monad={}))},{"./applicative":25}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MonadPlus=void 0;const r=e("./monad");class i extends r.Monad{}n.MonadPlus=i,i=n.MonadPlus||(n.MonadPlus={})},{"./monad":32}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),e("./sequence/member/static/resume"),e("./sequence/member/static/from"),e("./sequence/member/static/cycle"),e("./sequence/member/static/random"),e("./sequence/member/static/concat"),e("./sequence/member/static/zip"),e("./sequence/member/static/difference"),e("./sequence/member/static/union"),e("./sequence/member/static/intersect"),e("./sequence/member/static/pure"),e("./sequence/member/static/return"),e("./sequence/member/static/sequence"),e("./sequence/member/static/mempty"),e("./sequence/member/static/mconcat"),e("./sequence/member/static/mappend"),e("./sequence/member/static/mzero"),e("./sequence/member/static/mplus"),e("./sequence/member/instance/extract"),e("./sequence/member/instance/iterate"),e("./sequence/member/instance/memoize"),e("./sequence/member/instance/reduce"),e("./sequence/member/instance/take"),e("./sequence/member/instance/drop"),e("./sequence/member/instance/takeWhile"),e("./sequence/member/instance/dropWhile"),e("./sequence/member/instance/takeUntil"),e("./sequence/member/instance/dropUntil"),e("./sequence/member/instance/sort"),e("./sequence/member/instance/unique"),e("./sequence/member/instance/fmap"),e("./sequence/member/instance/ap"),e("./sequence/member/instance/bind"),e("./sequence/member/instance/join"),e("./sequence/member/instance/mapM"),e("./sequence/member/instance/filterM"),e("./sequence/member/instance/map"),e("./sequence/member/instance/filter"),e("./sequence/member/instance/scanl"),e("./sequence/member/instance/foldr"),e("./sequence/member/instance/group"),e("./sequence/member/instance/inits"),e("./sequence/member/instance/tails"),e("./sequence/member/instance/segs"),e("./sequence/member/instance/subsequences"),e("./sequence/member/instance/permutations");var r=e("./sequence/core");Object.defineProperty(n,"Sequence",{enumerable:!0,get:function(){return r.Sequence}})},{"./sequence/core":35,"./sequence/member/instance/ap":36,"./sequence/member/instance/bind":37,"./sequence/member/instance/drop":38,"./sequence/member/instance/dropUntil":39,"./sequence/member/instance/dropWhile":40,"./sequence/member/instance/extract":41,"./sequence/member/instance/filter":42,"./sequence/member/instance/filterM":43,"./sequence/member/instance/fmap":44,"./sequence/member/instance/foldr":45,"./sequence/member/instance/group":46,"./sequence/member/instance/inits":47,"./sequence/member/instance/iterate":48,"./sequence/member/instance/join":49,"./sequence/member/instance/map":50,"./sequence/member/instance/mapM":51,"./sequence/member/instance/memoize":52,"./sequence/member/instance/permutations":53,"./sequence/member/instance/reduce":54,"./sequence/member/instance/scanl":55,"./sequence/member/instance/segs":56,"./sequence/member/instance/sort":57,"./sequence/member/instance/subsequences":58,"./sequence/member/instance/tails":59,"./sequence/member/instance/take":60,"./sequence/member/instance/takeUntil":61,"./sequence/member/instance/takeWhile":62,"./sequence/member/instance/unique":63,"./sequence/member/static/concat":64,"./sequence/member/static/cycle":65,"./sequence/member/static/difference":66,"./sequence/member/static/from":67,"./sequence/member/static/intersect":68,"./sequence/member/static/mappend":69,"./sequence/member/static/mconcat":70,"./sequence/member/static/mempty":71,"./sequence/member/static/mplus":72,"./sequence/member/static/mzero":73,"./sequence/member/static/pure":74,"./sequence/member/static/random":75,"./sequence/member/static/resume":76,"./sequence/member/static/return":77,"./sequence/member/static/sequence":78,"./sequence/member/static/union":79,"./sequence/member/static/zip":80}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Sequence=void 0;const r=e("../monadplus");class i extends r.MonadPlus{constructor(e){super(s),this.cons=e}[Symbol.iterator](){let e=()=>this.iterate();return{next(){const t=e();return e=i.Thunk.iterator(t),{done:!i.isIterable(t),value:i.Thunk.value(t)}}}}}function s(){throw new Error("Spica: Sequence: Invalid thunk call.")}n.Sequence=i,i=n.Sequence||(n.Sequence={}),function(e){let t,n,r,i;!function(t){t.cons=function(t,n){switch(arguments.length){case 0:return[];case 1:return[t];case 2:return[t,n];default:throw e.Exception.invalidConsError(arguments)}}}(t=e.Data||(e.Data={})),function(e){e.value=function(e){return e[0]},e.iterator=function(e){return e[1]},e.index=function(e){return e[2]}}(n=e.Thunk||(e.Thunk={})),function(t){t.done=(()=>[void 0,t.done,-1]),t.when=function t(r,i,s){return e.isIterable(r)?s(r,()=>t(n.iterator(r)(),i,s)):i(r)}}(r=e.Iterator||(e.Iterator={})),e.isIterable=function(e){return n.iterator(e)!==r.done},function(e){e.invalidConsError=function(e){return console.error(e,e.length,e[0],e[1]),new TypeError("Spica: Sequence: Invalid parameters of cons.")},e.invalidDataError=function(e){return console.error(e),new TypeError("Spica: Sequence: Invalid data.")},e.invalidThunkError=function(e){return console.error(e),new TypeError("Spica: Sequence: Invalid thunk.")}}(i=e.Exception||(e.Exception={}))}(i=n.Sequence||(n.Sequence={}))},{"../monadplus":33}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{ap(e){return r.Sequence.ap(this,e)}})},{"../../../../helper/compose":20,"../../core":35}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{bind(e){return r.Sequence.concat(this.fmap(e))}})},{"../../../../helper/compose":20,"../../core":35}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{drop(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(t(),()=>n(),(t,i)=>r.Sequence.Thunk.index(t)<e?i():n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t))))}})},{"../../../../helper/compose":20,"../../core":35}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{dropUntil(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(t(),()=>n(),(t,i)=>e(r.Sequence.Thunk.value(t))?i():n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t))))}})},{"../../../../helper/compose":20,"../../core":35}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{dropWhile(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(t(),()=>n(),(t,i)=>e(r.Sequence.Thunk.value(t))?i():n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t))))}})},{"../../../../helper/compose":20,"../../core":35}],41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{extract(){const e=[];let t=()=>this.iterate();for(;;){const n=t();if(!r.Sequence.isIterable(n))return e;e.push(r.Sequence.Thunk.value(n)),t=r.Sequence.Thunk.iterator(n)}}})},{"../../../../helper/compose":20,"../../core":35}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{filter(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(t(),()=>n(),(t,i)=>e(r.Sequence.Thunk.value(t),r.Sequence.Thunk.index(t))?n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t)):i()))}})},{"../../../../helper/compose":20,"../../core":35}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{filterM(e){return r.Sequence.from([0]).bind(()=>{const t=this.extract();switch(t.length){case 0:return r.Sequence.from([[]]);default:{const n=t.shift();return e(n).bind(i=>i?0===t.length?r.Sequence.from([[n]]):r.Sequence.from(t).filterM(e).fmap(e=>[n,...e]):0===t.length?r.Sequence.from([[]]):r.Sequence.from(t).filterM(e))}}})}})},{"../../../../helper/compose":20,"../../core":35}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{fmap(e){return new r.Sequence((t=(()=>this.iterate()))=>r.Sequence.Iterator.when(t(),()=>r.Sequence.Data.cons(),t=>r.Sequence.Data.cons(e(r.Sequence.Thunk.value(t)),r.Sequence.Thunk.iterator(t))))}})},{"../../../../helper/compose":20,"../../core":35}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{foldr(e,t){return new r.Sequence((n=(()=>this.reduce().iterate()))=>r.Sequence.Iterator.when(n(),()=>r.Sequence.Data.cons(t),n=>r.Sequence.Data.cons(e(r.Sequence.Thunk.value(n),r.Sequence.resume(r.Sequence.Thunk.iterator(n)).foldr(e,t))))).bind(e=>e)}})},{"../../../../helper/compose":20,"../../core":35}],46:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{group(e){return new r.Sequence(([t,n]=[()=>this.iterate(),[]],i)=>r.Sequence.Iterator.when(t(),()=>0===n.length?i():i(n),(t,s)=>0===n.length||e(n[0],r.Sequence.Thunk.value(t))?(n.push(r.Sequence.Thunk.value(t)),s()):i(n,[r.Sequence.Thunk.iterator(t),[r.Sequence.Thunk.value(t)]])))}})},{"../../../../helper/compose":20,"../../core":35}],47:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{inits(){return r.Sequence.mappend(r.Sequence.from([[]]),this.scanl((e,t)=>[...e,t],[]).dropWhile(e=>0===e.length))}})},{"../../../../helper/compose":20,"../../core":35}],48:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{iterate(){return this.iterate_()}iterate_(e,t=0){const n=this.cons(e,r.Sequence.Data.cons);switch(n.length){case 0:return[void 0,r.Sequence.Iterator.done,-1];case 1:return[n[0],()=>r.Sequence.Iterator.done(),t];case 2:return[n[0],()=>this.iterate_(n[1],t+1),t];default:throw r.Sequence.Exception.invalidDataError(n)}}})},{"../../../../helper/compose":20,"../../core":35}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{join(){return r.Sequence.concat(this)}})},{"../../../../helper/compose":20,"../../core":35}],50:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{map(e){return new r.Sequence((t=(()=>this.iterate()))=>r.Sequence.Iterator.when(t(),()=>r.Sequence.Data.cons(),t=>r.Sequence.Data.cons(e(r.Sequence.Thunk.value(t),r.Sequence.Thunk.index(t)),r.Sequence.Thunk.iterator(t))))}})},{"../../../../helper/compose":20,"../../core":35}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{mapM(e){return r.Sequence.from([0]).bind(()=>{const t=this.extract();switch(t.length){case 0:return r.Sequence.mempty;default:{const n=t.shift();return e(n).bind(n=>0===t.length?r.Sequence.from([[n]]):r.Sequence.from(t).mapM(e).fmap(e=>[n,...e]))}}})}})},{"../../../../helper/compose":20,"../../core":35}],52:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../../../global"),i=e("../../core"),s=e("../../../../helper/compose"),o=e("../../../../memoize").memoize(e=>new r.Map);s.compose(i.Sequence,class extends i.Sequence{memoize(){return new i.Sequence(([e,t]=[0,o(this)],n)=>i.Sequence.Iterator.when(t.get(e)||t.set(e,e>0&&t.has(e-1)?i.Sequence.Thunk.iterator(t.get(e-1))():this.iterate()).get(e),()=>n(),r=>n(i.Sequence.Thunk.value(r),[e+1,t])))}})},{"../../../../global":19,"../../../../helper/compose":20,"../../../../memoize":24,"../../core":35}],53:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{permutations(){return r.Sequence.from([0]).bind(()=>{const e=this.extract();return 0===e.length?r.Sequence.mempty:r.Sequence.from([e])}).bind(e=>r.Sequence.mappend(r.Sequence.from([e]),function e(t,n){return r.Sequence.Iterator.when(t.iterate(),()=>r.Sequence.mempty,t=>new r.Sequence((i,s)=>r.Sequence.Iterator.when(t,()=>s(),t=>{const i=r.Sequence.Thunk.value(t),o=r.Sequence.resume(r.Sequence.Thunk.iterator(t)).memoize();return s(n.permutations().foldr((e,t)=>(function(e,t){return function e(t,n,s){return r.Sequence.Iterator.when(n.iterate(),()=>[o,s],n=>{const o=r.Sequence.Thunk.value(n),[c,a]=e(e=>t(r.Sequence.mappend(r.Sequence.from([o]),e)),r.Sequence.resume(r.Sequence.Thunk.iterator(n)),s);return[r.Sequence.mappend(r.Sequence.from([o]),c),r.Sequence.mappend(r.Sequence.from([t(r.Sequence.mappend(r.Sequence.from([i]),r.Sequence.mappend(r.Sequence.from([o]),c))).extract()]),a)]})}(e=>e,e,t)[1]})(r.Sequence.from(e),t),e(o,r.Sequence.mappend(r.Sequence.from([i]),n))))})).bind(e=>e))}(r.Sequence.from(e),r.Sequence.mempty)))}})},{"../../../../helper/compose":20,"../../core":35}],54:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../../../global"),i=e("../../core");e("../../../../helper/compose").compose(i.Sequence,class extends i.Sequence{reduce(){return new i.Sequence(([e,t]=[0,new r.Map],n)=>i.Sequence.Iterator.when(t.get(e)||t.set(e,e>0&&t.has(e-1)?i.Sequence.Thunk.iterator(t.get(e-1))():this.iterate()).get(e),()=>n(),r=>n(i.Sequence.Thunk.value(r),[e+1,t])))}})},{"../../../../global":19,"../../../../helper/compose":20,"../../core":35}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{scanl(e,t){return new r.Sequence(([n,i,s]=[t,()=>this.iterate(),0])=>r.Sequence.Iterator.when(i(),()=>0===s?r.Sequence.Data.cons(t):r.Sequence.Data.cons(),t=>r.Sequence.Data.cons(n=e(n,r.Sequence.Thunk.value(t)),[n,r.Sequence.Thunk.iterator(t),r.Sequence.Thunk.index(t)+1])))}})},{"../../../../helper/compose":20,"../../core":35}],56:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{segs(){return r.Sequence.mappend(this.foldr((e,t)=>t.take(1).bind(n=>r.Sequence.mappend(r.Sequence.from([r.Sequence.mappend(r.Sequence.from([[e]]),r.Sequence.from(n).map(t=>[e,...t]))]),t)),r.Sequence.from([r.Sequence.from([])])).bind(e=>e),r.Sequence.from([[]]))}})},{"../../../../helper/compose":20,"../../core":35}],57:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{sort(e){return r.Sequence.from(this.extract().sort(e))}})},{"../../../../helper/compose":20,"../../core":35}],58:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{subsequences(){return r.Sequence.mappend(r.Sequence.from([[]]),r.Sequence.from([0]).bind(()=>(function e(t){return r.Sequence.Iterator.when(t.iterate(),()=>r.Sequence.mempty,t=>r.Sequence.mappend(r.Sequence.from([[r.Sequence.Thunk.value(t)]]),new r.Sequence((n,i)=>r.Sequence.Iterator.when(t,()=>i(),t=>i(e(r.Sequence.resume(r.Sequence.Thunk.iterator(t))).foldr((e,n)=>r.Sequence.mappend(r.Sequence.mappend(r.Sequence.from([e]),r.Sequence.from([[r.Sequence.Thunk.value(t),...e]])),n),r.Sequence.mempty)))).bind(e=>e)))})(this)))}})},{"../../../../helper/compose":20,"../../core":35}],59:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{tails(){return r.Sequence.mappend(r.Sequence.from(this.extract().map((e,t,n)=>n.slice(t))),r.Sequence.from([[]]))}})},{"../../../../helper/compose":20,"../../core":35}],60:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{take(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(e>0?t():r.Sequence.Iterator.done(),()=>n(),t=>r.Sequence.Thunk.index(t)+1<e?n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t)):n(r.Sequence.Thunk.value(t))))}})},{"../../../../helper/compose":20,"../../core":35}],61:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{takeUntil(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(t(),()=>n(),t=>e(r.Sequence.Thunk.value(t))?n(r.Sequence.Thunk.value(t)):n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t))))}})},{"../../../../helper/compose":20,"../../core":35}],62:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{takeWhile(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(t(),()=>n(),t=>e(r.Sequence.Thunk.value(t))?n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t)):n()))}})},{"../../../../helper/compose":20,"../../core":35}],63:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{unique(){const e=new Set;return this.filter(t=>!e.has(t)&&!!e.add(t))}})},{"../../../../helper/compose":20,"../../core":35}],64:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{static concat(e){return new r.Sequence(([t,n]=[()=>e.iterate(),r.Sequence.Iterator.done],i)=>r.Sequence.Iterator.when(t(),()=>i(),(e,t)=>(n=n===r.Sequence.Iterator.done?()=>r.Sequence.Thunk.value(e).iterate():n,r.Sequence.Iterator.when(n(),()=>(n=r.Sequence.Iterator.done,t()),t=>i(r.Sequence.Thunk.value(t),[()=>e,r.Sequence.Thunk.iterator(t)])))))}})},{"../../../../helper/compose":20,"../../core":35}],65:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{static cycle(e){return new r.Sequence(function t([n,r]=[e[Symbol.iterator](),0],i){const s=n.next();return s.done?t([e[Symbol.iterator](),r+1],i):i(s.value,[n,r+1])}).reduce()}})},{"../../../../helper/compose":20,"../../core":35}],66:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{static difference(e,t,n){return new r.Sequence(([i,s]=[()=>e.iterate(),()=>t.iterate()],o)=>r.Sequence.Iterator.when(i(),()=>r.Sequence.Iterator.when(s(),()=>o(),e=>o(r.Sequence.Thunk.value(e),[r.Sequence.Iterator.done,r.Sequence.Thunk.iterator(e)])),(e,t)=>r.Sequence.Iterator.when(s(),()=>o(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),r.Sequence.Iterator.done]),i=>{const c=n(r.Sequence.Thunk.value(e),r.Sequence.Thunk.value(i));return c<0?o(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),()=>i]):c>0?o(r.Sequence.Thunk.value(i),[()=>e,r.Sequence.Thunk.iterator(i)]):(s=(()=>r.Sequence.Thunk.iterator(i)()),t())})))}})},{"../../../../helper/compose":20,"../../core":35}],67:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{static from(e){return new r.Sequence(([t,n]=[e[Symbol.iterator](),0],r)=>{const i=t.next();return i.done?r():r(i.value,[t,n+1])}).reduce()}})},{"../../../../helper/compose":20,"../../core":35}],68:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{static intersect(e,t,n){return new r.Sequence(([i,s]=[()=>e.iterate(),()=>t.iterate()],o)=>r.Sequence.Iterator.when(i(),()=>o(),(e,t)=>r.Sequence.Iterator.when(s(),()=>o(),(i,c)=>{const a=n(r.Sequence.Thunk.value(e),r.Sequence.Thunk.value(i));return a<0?(s=(()=>i),t()):a>0?c():o(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),r.Sequence.Thunk.iterator(i)])})))}})},{"../../../../helper/compose":20,"../../core":35}],69:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{static mappend(e,t){return r.Sequence.mconcat([e,t])}})},{"../../../../helper/compose":20,"../../core":35}],70:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{static mconcat(e){return[...e].reduce((e,t)=>(function(e,t){return new r.Sequence(([n,i]=[()=>e.iterate(),()=>t.iterate()],s)=>r.Sequence.Iterator.when(n(),()=>r.Sequence.Iterator.when(i(),()=>s(),e=>s(r.Sequence.Thunk.value(e),[r.Sequence.Iterator.done,r.Sequence.Thunk.iterator(e)])),e=>s(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),i])))})(e,t),r.Sequence.mempty)}})},{"../../../../helper/compose":20,"../../core":35}],71:[function(e,t,n){"use strict";var r;Object.defineProperty(n,"__esModule",{value:!0});const i=e("../../core");e("../../../../helper/compose").compose(i.Sequence,((r=class extends i.Sequence{}).mempty=new i.Sequence((e,t)=>t()),r))},{"../../../../helper/compose":20,"../../core":35}],72:[function(e,t,n){"use strict";var r;Object.defineProperty(n,"__esModule",{value:!0});const i=e("../../core");e("../../../../helper/compose").compose(i.Sequence,((r=class extends i.Sequence{}).mplus=i.Sequence.mappend,r))},{"../../../../helper/compose":20,"../../core":35}],73:[function(e,t,n){"use strict";var r;Object.defineProperty(n,"__esModule",{value:!0});const i=e("../../core");e("../../../../helper/compose").compose(i.Sequence,((r=class extends i.Sequence{}).mzero=i.Sequence.mempty,r))},{"../../../../helper/compose":20,"../../core":35}],74:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{static pure(e){return new r.Sequence((t,n)=>n(e))}})},{"../../../../helper/compose":20,"../../core":35}],75:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{static random(e=(()=>Math.random())){return"function"==typeof e?r.Sequence.from(new r.Sequence((t,n)=>n(e(),t))):this.random().map(t=>e[t*e.length|0])}})},{"../../../../helper/compose":20,"../../core":35}],76:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{static resume(e){return new r.Sequence((t=e,n)=>r.Sequence.Iterator.when(t(),()=>n(),e=>n(r.Sequence.Thunk.value(e),r.Sequence.Thunk.iterator(e))))}})},{"../../../../helper/compose":20,"../../core":35}],77:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{static Return(e){return new r.Sequence((t,n)=>n(e))}})},{"../../../../helper/compose":20,"../../core":35}],78:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{static sequence(e){return e.reduce((e,t)=>e.fmap(e=>r.Sequence.mappend(e,t)),r.Sequence.Return(r.Sequence.from([])))}})},{"../../../../helper/compose":20,"../../core":35}],79:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{static union(e,t,n){return new r.Sequence(([i,s]=[()=>e.iterate(),()=>t.iterate()],o)=>r.Sequence.Iterator.when(i(),()=>r.Sequence.Iterator.when(s(),()=>o(),e=>o(r.Sequence.Thunk.value(e),[r.Sequence.Iterator.done,r.Sequence.Thunk.iterator(e)])),e=>r.Sequence.Iterator.when(s(),()=>o(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),r.Sequence.Iterator.done]),t=>{const i=n(r.Sequence.Thunk.value(e),r.Sequence.Thunk.value(t));return i<0?o(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),()=>t]):i>0?o(r.Sequence.Thunk.value(t),[()=>e,r.Sequence.Thunk.iterator(t)]):o(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),r.Sequence.Thunk.iterator(t)])})))}})},{"../../../../helper/compose":20,"../../core":35}],80:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");e("../../../../helper/compose").compose(r.Sequence,class extends r.Sequence{static zip(e,t){return new r.Sequence(([n,i]=[()=>e.iterate(),()=>t.iterate()],s)=>r.Sequence.Iterator.when(n(),()=>s(),e=>r.Sequence.Iterator.when(i(),()=>s(),t=>s([r.Sequence.Thunk.value(e),r.Sequence.Thunk.value(t)],[r.Sequence.Thunk.iterator(e),r.Sequence.Thunk.iterator(t)]))))}})},{"../../../../helper/compose":20,"../../core":35}],81:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.noop=void 0,n.noop=function(){}},{}],82:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Observation=void 0;const r=e("./global"),i=e("./assign"),s=e("./array"),o=e("./exception");class c{constructor(e,t){this.parent=e,this.index=t,this.children=new r.Map,this.childrenIndexes=[],this.monitors=[],this.subscribers=[]}}n.Observation=class{constructor(e={}){this.id=0,this.node=new c(r.undefined,r.undefined),this.settings={limit:10,cleanup:!1},this.unrelaies=new r.WeakMap,i.extend(this.settings,e)}monitor(e,t,{once:n=!1}={}){if("function"!=typeof t)throw new r.Error(`Spica: Observation: Invalid listener: ${t}`);const{monitors:i}=this.seekNode(e,0);if(i.length===this.settings.limit)throw new r.Error("Spica: Observation: Exceeded max listener limit.");if(this.id===r.Number.MAX_SAFE_INTEGER)throw new r.Error("Spica: Observation: Max listener ID reached max safe integer.");const s={id:++this.id,type:0,namespace:e,listener:t,options:{once:n}};return i.push(s),()=>void this.off(e,s)}on(e,t,{once:n=!1}={}){if("function"!=typeof t)throw new r.Error(`Spica: Observation: Invalid listener: ${t}`);const{subscribers:i}=this.seekNode(e,0);if(i.length===this.settings.limit)throw new r.Error("Spica: Observation: Exceeded max listener limit.");if(this.id===r.Number.MAX_SAFE_INTEGER)throw new r.Error("Spica: Observation: Max listener ID reached max safe integer.");const s={id:++this.id,type:1,namespace:e,listener:t,options:{once:n}};return i.push(s),()=>void this.off(e,s)}once(e,t){return this.on(e,t,{once:!0})}off(e,t){const n=this.seekNode(e,1);if(n)switch(typeof t){case"object":{const e=0===t.type?n.monitors:n.subscribers;if(0===e.length||t.id<e[0].id||t.id>e[e.length-1].id)return;return void s.splice(e,e.indexOf(t),1)}case"function":{const e=n.subscribers;return void s.splice(e,e.findIndex(e=>e.listener===t),1)}case"undefined":return void function e({monitors:t,subscribers:n,childrenIndexes:r,children:i}){for(let t=0;t<r.length;++t)e(i.get(r[t]))&&(i.delete(r[t]),s.splice(r,t,1),--t);return s.splice(n,0),0===t.length}(n)}}emit(e,t,n){this.drain(e,t,n)}reflect(e,t){let n;return this.emit(e,t,(e,t)=>n=t),n}relay(e){if(this.unrelaies.has(e))return this.unrelaies.get(e);const t=e.monitor([],(e,t)=>void this.emit(t,e)),n=()=>(this.unrelaies.delete(e),void t());return this.unrelaies.set(e,n),n}refs(e){const t=this.seekNode(e,1);return t?s.push(this.refsBelow(t,0),this.refsBelow(t,1)).reduce((e,t)=>s.push(e,t),[]):[]}drain(e,t,n){const r=this.seekNode(e,1),i=[],s=r?this.refsBelow(r,1):[];for(let r=0;r<s.length;++r){const c=s[r];if(0!==c.length)for(let r=0,s=c[c.length-1].id;r<c.length&&c[r].id<=s;++r){const s=c[r];s.options.once&&this.off(s.namespace,s);try{const r=s.listener(t,e);n&&i.push(r)}catch(e){o.causeAsyncException(e)}for(r=r<c.length?r:c.length-1;r>=0&&c[r].id>s.id;--r);}}const c=this.refsAbove(r||this.seekNode(e,2),0);for(let n=0;n<c.length;++n){const r=c[n];if(0!==r.length)for(let n=0,i=r[r.length-1].id;n<r.length&&r[n].id<=i;++n){const i=r[n];i.options.once&&this.off(i.namespace,i);try{i.listener(t,e)}catch(e){o.causeAsyncException(e)}for(n=n<r.length?n:r.length-1;n>=0&&r[n].id>i.id;--n);}}if(n)try{n(t,i)}catch(e){o.causeAsyncException(e)}}refsAbove({parent:e,monitors:t,subscribers:n},r){const i=0===r?[t]:[n];for(;e;)0===r?i.push(e.monitors):i.push(e.subscribers),e=e.parent;return i}refsBelow(e,t){return this.refsBelow_(e,t,[])[0]}refsBelow_({monitors:e,subscribers:t,childrenIndexes:n,children:r},i,o){0===i?o.push(e):o.push(t);let c=0;for(let e=0;e<n.length;++e){const t=n[e],a=this.refsBelow_(r.get(t),i,o)[1];c+=a,0===a&&this.settings.cleanup&&(r.delete(t),s.splice(n,e,1),--e)}return[o,e.length+t.length+c]}seekNode(e,t){let n=this.node;for(let r=0;r<e.length;++r){const i=e[r],{childrenIndexes:s,children:o}=n;let a=o.get(i);if(!a){switch(t){case 1:return;case 2:return n}a=new c(n,i),s.push(i),o.set(i,a)}n=a}return n}}},{"./array":5,"./assign":6,"./exception":16,"./global":19}],83:[function(e,t,n){"use strict";var r;Object.defineProperty(n,"__esModule",{value:!0}),n.isPromiseLike=n.Internal=n.AtomicPromise=void 0;const i=e("./global"),s=e("./alias"),o=e("./array"),c=Symbol.for("spica/promise::internal");class a{constructor(e){this[Symbol.toStringTag]="Promise",this[r]=new u;try{e(e=>this[c].resolve(e),e=>this[c].reject(e))}catch(e){this[c].reject(e)}}static get[Symbol.species](){return a}static all(e){return new a((t,n)=>{const r=s.isArray(e)?e:[...e],o=i.Array(r.length);let a=0;for(let e=0;e<r.length;++e){const i=r[e];if(l(i)){if(h(i)){const{status:t}=i[c];switch(t.state){case 2:o[e]=t.value,++a;continue;case 3:n(t.reason),e=r.length;continue}}i.then(n=>{o[e]=n,++a===r.length&&t(o)},t=>{n(t),e=r.length})}else o[e]=i,++a}a===r.length&&t(o)})}static race(e){return new a((t,n)=>{const r=s.isArray(e)?e:[...e];for(let e=0;e<r.length;++e){const i=r[e];if(!l(i))return t(i);if(h(i)){const{status:e}=i[c];switch(e.state){case 2:return t(e.value);case 3:return n(e.reason)}}}let i=!1;for(let e=0;e<r.length;++e){if(r[e].then(e=>{t(e),i=!0},e=>{n(e),i=!0}),i)return}})}static allSettled(e){return new a(t=>{const n=s.isArray(e)?e:[...e],r=i.Array(n.length);let o=0;for(let e=0;e<n.length;++e){const i=n[e];if(l(i)){if(h(i)){const{status:t}=i[c];switch(t.state){case 2:r[e]={status:"fulfilled",value:t.value},++o;continue;case 3:r[e]={status:"rejected",reason:t.reason},++o;continue}}i.then(i=>{r[e]={status:"fulfilled",value:i},++o===n.length&&t(r)},i=>{r[e]={status:"rejected",reason:i},++o===n.length&&t(r)})}else r[e]={status:"fulfilled",value:i},++o}o===n.length&&t(r)})}static resolve(e){return new a(t=>t(e))}static reject(e){return new a((t,n)=>n(e))}then(e,t){return new a((n,r)=>this[c].then(e,t,n,r))}catch(e){return this.then(i.undefined,e)}finally(e){return this.then(e,e).then(()=>this)}}n.AtomicPromise=a,r=c;class u{constructor(){this.status={state:0},this.reactable=!0,this.fulfillReactions=[],this.rejectReactions=[],this.isHandled=!1}get isPending(){return 0===this.status.state}resolve(e){if(0===this.status.state){if(!l(e))return this.status={state:2,value:e},this.resume();this.status={state:1,promise:e},e.then(e=>{this.status={state:2,value:e},this.resume()},e=>{this.status={state:3,reason:e},this.resume()})}}reject(e){if(0===this.status.state)return this.status={state:3,reason:e},this.resume()}then(e,t,n,r){const{status:i,fulfillReactions:s,rejectReactions:o}=this;switch(i.state){case 2:if(s.length>0)break;try{return n(e?e(i.value):i.value)}catch(e){return r(e)}case 3:if(o.length>0)break;try{return t?n(t(i.reason)):r(i.reason)}catch(e){return r(e)}default:return s.push(t=>{try{n(e?e(t):t)}catch(e){r(e)}}),o.push(e=>{try{t?n(t(e)):r(e)}catch(e){r(e)}}),this.resume()}}resume(){if(!this.reactable)return;const{status:e,fulfillReactions:t,rejectReactions:n}=this;switch(e.state){case 0:case 1:return;case 2:if(this.isHandled&&n.length>0&&o.splice(n,0),0===t.length)return;return this.isHandled=!0,void this.react(t,e.value);case 3:if(this.isHandled&&t.length>0&&o.splice(t,0),0===n.length)return;return this.isHandled=!0,void this.react(n,e.reason)}}react(e,t){if(this.reactable=!1,e.length<5)for(;e.length>0;)e.shift()(t);else{for(let n=0;n<e.length;++n)e[n](t);o.splice(e,0)}this.reactable=!0}}function l(e){return null!==e&&"object"==typeof e&&"then"in e&&"function"==typeof e.then}function h(e){return c in e}n.Internal=u,n.isPromiseLike=l},{"./alias":4,"./array":5,"./global":19}],84:[function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./monad/sequence"),n)},{"./monad/sequence":34}],85:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.sqid=void 0;const r=e("./global"),i="0".repeat(15);let s=0;n.sqid=function e(t){if(0===arguments.length){if(s===r.Number.MAX_SAFE_INTEGER)throw new TypeError("Spica: sqid: sqid reached max safe integer.");return e(++s)}if("number"!=typeof t)throw new TypeError(`Spica: sqid: A parameter value must be a number: ${t}`);if(t>=0==0)throw new TypeError(`Spica: sqid: A parameter value must be a positive number: ${t}`);if(t%1!=0)throw new TypeError(`Spica: sqid: A parameter value must be an integer: ${t}`);return(i+t).slice(-16)}},{"./global":19}],86:[function(e,t,n){"use strict";var r;Object.defineProperty(n,"__esModule",{value:!0}),n.Supervisor=void 0;const i=e("./global"),s=e("./alias"),o=e("./coroutine"),c=e("./promise"),a=e("./future"),u=e("./observation"),l=e("./array"),h=e("./assign"),d=e("./clock"),p=e("./sqid"),f=e("./exception");class m extends o.Coroutine{constructor(e={}){if(super(async function*(){return this.state},{delay:!1}),this.state=new a.AtomicFuture,this.id=p.sqid(),this.settings={name:"",size:i.Infinity,timeout:i.Infinity,destructor:e=>void 0,scheduler:d.tick,resource:10},this.events_={init:new u.Observation,loss:new u.Observation,exit:new u.Observation},this.events=this.events_,this.workers=new i.Map,this.alive=!0,this.available=!0,this[r]={ask:()=>{throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot use coroutine port.`)},recv:()=>{throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot use coroutine port.`)},send:()=>{throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot use coroutine port.`)},connect:()=>{throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot use coroutine port.`)}},this.scheduled=!1,this.messages=[],h.extend(this.settings,e),this.name=this.settings.name,this.constructor===m)throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot instantiate abstract classes.`);this.constructor.instances.add(this)}static get instances(){return this.hasOwnProperty("instances_")?this.instances_:this.instances_=new i.Set}static get count(){return this.instances.size}static get procs(){return[...this.instances].reduce((e,t)=>e+t.workers.size,0)}static clear(e){for(;this.instances.size>0;)for(const t of this.instances)t.terminate(e)}destructor(e){for(this.available=!1,this.clear(e),s.ObjectFreeze(this.workers);this.messages.length>0;){const[e,t]=this.messages.shift(),n="string"==typeof e?e:e[Symbol.iterator]().next().value;this.events_.loss.emit([n],[n,t])}this.alive=!1,this.constructor.instances.delete(this),s.ObjectFreeze(this),this.settings.destructor(e),this.state.bind(void 0===e?void 0:c.AtomicPromise.reject(e))}throwErrorIfNotAvailable(){if(!this.available)throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: A supervisor is already terminated.`)}register(e,t,n){if(n=n,this.throwErrorIfNotAvailable(),o.isCoroutine(t)){const r=t[t.constructor.port],i={init:e=>e,main:(e,t,n)=>r.ask(e).then(({value:e,done:r})=>r&&void n()||[e,t]),exit:e=>void t[t.constructor.terminate](e)};this.constructor.standalone.add(i);const s=this.register(e,i,n);return t.catch(s),s}if(function(e){return"AsyncGeneratorFunction"===e[Symbol.toStringTag]}(t)){let r;return this.register(e,{init:(e,n)=>(r=t(e,n),r.next().catch(n),e),main:(e,t,n)=>c.AtomicPromise.resolve(r.next(e)).then(({value:e,done:r})=>r&&void n()||[e,t]),exit:()=>void 0},n)}if("function"==typeof t){if(function(e){return"GeneratorFunction"===e[Symbol.toStringTag]}(t)){let r;return this.register(e,{init:(e,n)=>(r=t(e,n),r.next(),e),main:(e,t,n)=>{const{value:i,done:s}=r.next(e);return s&&n(),[i,t]},exit:()=>void 0},n)}return this.register(e,{init:e=>e,main:t,exit:()=>void 0},n)}if(this.workers.has(e))throw new i.Error(`Spica: Supervisor: <${this.id}/${this.name}/${e}>: Cannot register a process multiply with the same name.`);this.schedule();const r=new b(e,t,n,this,()=>void this.schedule(),this.constructor.standalone.has(t),this.events_,()=>this.workers.get(e)===r&&void this.workers.delete(e));return this.workers.set(e,r),r.terminate}call(e,t,n=this.settings.timeout,r=this.settings.timeout){if("function"!=typeof n)return new c.AtomicPromise((r,i)=>void this.call(e,t,(e,t)=>t?i(t):r(e),n));for(this.messages.push(["string"==typeof e?e:new v(this.workers,e),t,n,Date.now()+r]);this.messages.length>(this.available?this.settings.size:0);){const[e,t,n]=this.messages.shift(),r="string"==typeof e?e:e[Symbol.iterator]().next().value;this.events_.loss.emit([r],[r,t]);try{n(void 0,new i.Error(`Spica: Supervisor: <${this.id}/${this.name}>: A message overflowed.`))}catch(e){f.causeAsyncException(e)}}this.throwErrorIfNotAvailable(),this.schedule(),r>0&&r!==i.Infinity&&i.setTimeout(()=>void this.schedule(),r+3)}cast(e,t,n=this.settings.timeout){var r;let i;for(e of(this.throwErrorIfNotAvailable(),"string"==typeof e?[e]:new v(this.workers,e)))if(i=null===(r=this.workers.get(e))||void 0===r?void 0:r.call([t,Date.now()+n]))break;return e=e,!!i||(this.events_.loss.emit([e],[e,t]),!1)}refs(e){return void 0===e?[...this.workers.values()].map(t):this.workers.has(e)?[t(this.workers.get(e))]:[];function t(e){return[e.name,e.process,e.state,e.terminate]}}kill(e,t){return!!this.available&&(!!this.workers.has(e)&&this.workers.get(e).terminate(t))}clear(e){for(;this.workers.size>0;)for(const t of this.workers.values())t.terminate(e)}terminate(e){return!!this.available&&(this.destructor(e),this[o.Coroutine.exit](void 0),!0)}[o.Coroutine.terminate](e){this.terminate(e)}schedule(){if(!this.available||this.scheduled||0===this.messages.length)return;const e=new a.AtomicFuture(!1);e.finally(()=>{this.scheduled=!1,this.deliver()}),d.tick(()=>{this.settings.scheduler.call(void 0,e.bind),this.settings.scheduler===requestAnimationFrame&&i.setTimeout(e.bind,1e3)}),this.scheduled=!0}deliver(){var e;if(!this.available)return;const t=Date.now();for(let n=0,r=this.messages.length;this.available&&n<r;++n){if(this.settings.resource-(Date.now()-t)<=0)return void this.schedule();const[s,o,c,a]=this.messages[n];let u,h;for(h of"string"==typeof s?[s]:s)if(u=null===(e=this.workers.get(h))||void 0===e?void 0:e.call([o,a]))break;if(!(void 0===u&&Date.now()<a))if(l.splice(this.messages,n,1),--n,--r,void 0===u){this.events_.loss.emit([h],[h,o]);try{c(void 0,new i.Error("Spica: Supervisor: A process has failed."))}catch(e){f.causeAsyncException(e)}}else u.then(e=>void c(e),()=>void c(void 0,new i.Error("Spica: Supervisor: A process has failed.")))}}}n.Supervisor=m,r=o.Coroutine.port,m.standalone=new i.WeakSet;class v{constructor(e,t=(e=>e)){this.workers=e,this.selector=t}*[Symbol.iterator](){let e=0;for(const t of this.selector(this.workers.keys()))++e,yield t;0===e&&(yield"")}}class b{constructor(e,t,n,r,i,s,o,c){this.name=e,this.process=t,this.state=n,this.sv=r,this.schedule=i,this.events=o,this.destructor_=c,this.alive=!0,this.available=!0,this.initiated=!1,this.terminate=(e=>!!this.alive&&(this.destructor(e),!0)),s&&this.init()}destructor(e){this.alive=!1,this.available=!1,s.ObjectFreeze(this);try{this.destructor_()}catch(e){f.causeAsyncException(e)}this.initiated&&this.exit(e)}init(){this.initiated=!0,this.events.init.emit([this.name],[this.name,this.process,this.state]),this.state=this.process.init(this.state,this.terminate)}exit(e){try{this.process.exit(e,this.state),this.events.exit.emit([this.name],[this.name,this.process,this.state,e])}catch(t){this.events.exit.emit([this.name],[this.name,this.process,this.state,e]),this.sv.terminate(t)}}call([e,t]){const n=Date.now();if(this.available&&!(n>t))return new c.AtomicPromise((r,o)=>{s.isFinite(t)&&i.setTimeout(()=>void o(new i.Error),t-n),this.available=!1,this.initiated||(this.init(),this.alive)?c.AtomicPromise.resolve(this.process.main(e,this.state,this.terminate)).then(r,o):o()}).then(([e,t])=>(this.alive&&(this.schedule(),this.state=t,this.available=!0),e)).catch(e=>{throw this.schedule(),this.terminate(e),e})}}},{"./alias":4,"./array":5,"./assign":6,"./clock":11,"./coroutine":13,"./exception":16,"./future":18,"./global":19,"./observation":82,"./promise":83,"./sqid":85}],87:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.debounce=n.throttle=void 0;const r=e("./list"),i=e("./global");n.throttle=function(e,t){let n=0,s=r.MList();return o=>{s.prepend(o),n>0||(n=i.setTimeout(()=>{n=0;const e=s;s=r.MList(),t(e.head,e)},e))}},n.debounce=function(e,t){let n=0,s=r.MList();return o=>{s.prepend(o),n>0||(n=i.setTimeout(()=>{n=0,i.setTimeout(()=>{if(n>0)return;const e=s;s=r.MList(),t(e.head,e)},s.length>1?e:0)},e))}}},{"./global":19,"./list":22}],88:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.tuple=void 0,n.tuple=function(...e){return e}},{}],89:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isPrimitive=n.isType=n.type=void 0;const r=Object.prototype.toString.call.bind(Object.prototype.toString);function i(e){const t=null==e?e:typeof e;switch(t){case void 0:case null:return`${e}`;case"boolean":case"number":case"bigint":case"string":case"symbol":return t;default:return r(e).slice(8,-1)}}n.type=i,n.isType=function(e,t){switch(t){case"function":return"function"==typeof e;case"object":return null!==e&&"object"==typeof e;default:return i(e)===t}},n.isPrimitive=function(e){switch(typeof e){case"undefined":case"boolean":case"number":case"bigint":case"string":case"symbol":return!0;default:return null===e}}},{}],90:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.URL=void 0;const r=e("./global"),i=e("./url/domain/format");var s=e("./url/domain/format");Object.defineProperty(n,"standardize",{enumerable:!0,get:function(){return s.standardize}});n.URL=class{constructor(e,t=r.location.href){this.url=new i.ReadonlyURL(e,t)}get reference(){var e;return this.reference_=null!==(e=this.reference_)&&void 0!==e?e:this.url.href}get resource(){return this.resource_=void 0===this.resource_?this.reference.slice(0,"?"===this.query?this.fragment?-this.fragment.length-1:-1:-this.fragment.length||this.reference.length):this.resource_}get origin(){var e;return this.origin_=null!==(e=this.origin_)&&void 0!==e?e:this.url.origin}get scheme(){var e;return this.scheme_=null!==(e=this.scheme_)&&void 0!==e?e:this.url.protocol.slice(0,-1)}get protocol(){var e;return this.protocol_=null!==(e=this.protocol_)&&void 0!==e?e:this.reference.slice(0,this.reference.indexOf(":")+1)}get host(){var e;return this.host_=null!==(e=this.host_)&&void 0!==e?e:this.url.host}get hostname(){var e;return this.hostname_=null!==(e=this.hostname_)&&void 0!==e?e:this.url.hostname}get port(){var e;return this.port_=null!==(e=this.port_)&&void 0!==e?e:this.url.port}get path(){var e;return this.path_=null!==(e=this.path_)&&void 0!==e?e:`${this.pathname}${this.query}`}get pathname(){var e;return this.pathname_=null!==(e=this.pathname_)&&void 0!==e?e:this.url.pathname}get query(){return this.query_=void 0===this.query_?this.reference.slice(~(~this.reference.slice(0,-this.fragment.length||this.reference.length).indexOf("?")||~this.reference.length),-this.fragment.length||this.reference.length):this.query_}get fragment(){return this.fragment_=void 0===this.fragment_?this.reference.slice(~(~this.reference.indexOf("#")||~this.reference.length)):this.fragment_}}},{"./global":19,"./url/domain/format":91}],91:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ReadonlyURL=n._encode=n.standardize=void 0;const r=e("../../global"),i=e("../../alias"),s=e("../../memoize"),o=e("../../cache"),c=e("../../flip"),a=e("../../curry");var u;function l(e){return e.trim().replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]?|[\uDC00-\uDFFF]/g,e=>2===e.length?e:"").replace(/%(?![0-9A-F]{2})|[^%\[\]]+/gi,encodeURI).replace(/\?[^#]+/,e=>"?"+e.slice(1).replace(/%[0-9A-F]{2}|[^=&]/gi,e=>e.length<3?encodeURIComponent(e):e)).replace(/%[0-9A-F]{2}/gi,e=>e.toUpperCase()).replace(/#.+/,e.slice(e.indexOf("#")).trim())}u||(u={}),n.standardize=function(e,t=r.location.href){return l(function(e,t){return new h(e,t).href}(e,t))},n._encode=l;class h{constructor(e,t){return h.freezable?i.ObjectFreeze(h.new(e,t)):h.new(e,t)}}n.ReadonlyURL=h,h.freezable=(()=>{try{return i.ObjectFreeze(new r.global.URL(r.location.href)),!0}catch(e){return!1}})(),h.new=c.flip(a.uncurry(s.memoize(e=>s.memoize(t=>new r.global.URL(function(e,t){return e.trim()||t}(t,e),e),new o.Cache(100)),new o.Cache(100))))},{"../../alias":4,"../../cache":7,"../../curry":14,"../../flip":17,"../../global":19,"../../memoize":24}],92:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.uuid=void 0;const r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",{random:i}=Math;n.uuid=function(){let e="";for(let t=0;t<r.length;++t){const n=r[t];if("x"===n||"y"===n){const t=16*i()|0;e+=("x"==n?t:3&t|8).toString(16)}else e+=n}return e}},{}],93:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),e("spica/global");var r=e("./src/builder");Object.defineProperty(n,"Shadow",{enumerable:!0,get:function(){return r.Shadow}}),Object.defineProperty(n,"HTML",{enumerable:!0,get:function(){return r.HTML}}),Object.defineProperty(n,"SVG",{enumerable:!0,get:function(){return r.SVG}}),Object.defineProperty(n,"API",{enumerable:!0,get:function(){return r.API}});var i=e("./src/proxy");Object.defineProperty(n,"proxy",{enumerable:!0,get:function(){return i.proxy}});var s=e("./src/util/dom");Object.defineProperty(n,"shadow",{enumerable:!0,get:function(){return s.shadow}}),Object.defineProperty(n,"frag",{enumerable:!0,get:function(){return s.frag}}),Object.defineProperty(n,"html",{enumerable:!0,get:function(){return s.html}}),Object.defineProperty(n,"svg",{enumerable:!0,get:function(){return s.svg}}),Object.defineProperty(n,"text",{enumerable:!0,get:function(){return s.text}}),Object.defineProperty(n,"element",{enumerable:!0,get:function(){return s.element}}),Object.defineProperty(n,"define",{enumerable:!0,get:function(){return s.define}});var o=e("./src/util/listener");Object.defineProperty(n,"listen",{enumerable:!0,get:function(){return o.listen}}),Object.defineProperty(n,"once",{enumerable:!0,get:function(){return o.once}}),Object.defineProperty(n,"wait",{enumerable:!0,get:function(){return o.wait}}),Object.defineProperty(n,"delegate",{enumerable:!0,get:function(){return o.delegate}}),Object.defineProperty(n,"bind",{enumerable:!0,get:function(){return o.bind}}),Object.defineProperty(n,"currentTarget",{enumerable:!0,get:function(){return o.currentTarget}});var c=e("./src/util/query");Object.defineProperty(n,"apply",{enumerable:!0,get:function(){return c.apply}})},{"./src/builder":94,"./src/proxy":96,"./src/util/dom":97,"./src/util/listener":98,"./src/util/query":99,"spica/global":19}],94:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SVG=n.HTML=n.Shadow=n.API=void 0;const r=e("spica/global"),i=e("spica/alias"),s=e("./proxy"),o=e("./util/dom");function c(e,t=(e=>e)){return new Proxy(()=>r.undefined,function(e,t){return{apply(e,t,[n,...r]){return this.get(e,n,e)(...r)},get:(n,c)=>n[c]||c in n||"string"!=typeof c?n[c]:n[c]=function(e,n){return function a(u,l,h){if("function"==typeof u)return a(r.undefined,r.undefined,u);if("function"==typeof l)return a(u,r.undefined,l);if(u!==r.undefined&&function(e){return"object"!=typeof e||i.ObjectValues(e).slice(-1).every(e=>"object"==typeof e)}(u))return a(r.undefined,u,h);const d=t(function(t,r,s){const a=t(n,e,r||{},s);if(e!==a.tagName.toLowerCase())throw new Error(`TypedDOM: Expected tag name is "${e}" but actually "${a.tagName.toLowerCase()}".`);if(t!==c){if(r)for(const e of i.ObjectKeys(r)){const t=r[e];"function"==typeof t&&a.removeEventListener(e,t)}o.define(a,r)}return a}(h||c,u,l));return 1===d.nodeType?new s.Elem(d,l):new s.Elem(d.host,l,d)};function c(e,t,n){return e(t,n)}}(c,e)}}(e,t))}n.API=c,n.Shadow=c(o.html,o.shadow),n.HTML=c(o.html),n.SVG=c(o.svg)},{"./proxy":96,"./util/dom":97,"spica/alias":4,"spica/global":19}],95:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.uid=void 0;const r=e("spica/uuid").uuid().split("-").pop();let i=0;n.uid=function(){return`id-${r}-${++i}`}},{"spica/uuid":92}],96:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Elem=n.proxy=void 0;const r=e("spica/global"),i=e("spica/alias"),s=e("./identity"),o=e("./util/dom"),c=e("spica/array"),a=new r.WeakMap;function u(e){const t=a.get(e);if(t)return t;throw new Error("TypedDOM: This element has no proxy.")}n.proxy=u;Symbol.for("typed-dom/tag");function l({element:e}){if(e.parentElement&&a.has(e.parentElement))throw new Error("TypedDOM: Typed DOM children must not be used to another typed DOM.")}n.Elem=class{constructor(e,t,n=e){switch(this.element=e,this.children_=t,this.container=n,this.id_="",this.query_="",this.isPartialUpdate=!1,this.isInit=!0,!0){case t===r.undefined:this.type=0;break;case"string"==typeof t:this.type=1;break;case i.isArray(t):this.type=2;break;case t&&"object"==typeof t:this.type=3;break;default:throw new Error("TypedDOM: Invalid type children.")}switch(l(this),a.set(this.element,this),this.type){case 0:return void(this.isInit=!1);case 1:return o.define(this.container,[]),this.children_=this.container.appendChild(o.text("")),this.children=t,void(this.isInit=!1);case 2:return o.define(this.container,[]),this.children_=[],this.children=t,void(this.isInit=!1);case 3:return o.define(this.container,[]),this.children_=this.observe({...t}),this.children=t,void(this.isInit=!1);default:throw new Error("TypedDOM: Unreachable code.")}}get id(){return this.id_?this.id_:(this.id_=this.element.id.trim(),this.id_?this.id_:(this.id_=s.uid(),this.element.classList.add(this.id_),this.id_))}get query(){if(this.query_)return this.query_;switch(!0){case this.element!==this.container:return this.query_=":host";case this.id===this.element.id.trim():return this.query_=`#${this.id}`;default:return this.query_=`.${this.id}`}}observe(e){const t={};for(const n of i.ObjectKeys(e)){if(n in{})continue;let r=e[n];l(r),this.container.appendChild(r.element),t[n]={configurable:!0,enumerable:!0,get:()=>r,set:e=>{const t=r;if(e!==t)if(this.isPartialUpdate)if(r=e,e.element.parentNode===t.element.parentNode){const n=e.element.nextSibling!==t.element?e.element.nextSibling:t.element.nextSibling;this.container.replaceChild(e.element,t.element),this.container.insertBefore(t.element,n)}else this.container.insertBefore(e.element,t.element),this.container.removeChild(t.element);else this.children={...this.children_,[n]:e}}}}return i.ObjectDefineProperties(e,t)}scope(e){const t=e.element;switch(!1){case"type"in t:case"media"in t:case"STYLE"===t.tagName:return}const n=/(^|[,}])(\s*)\$scope(?![\w-])(?=[^;{}]*{)/g,r=t.innerHTML;if(-1===r.search(n))return;const i=this.query;if(/^[:#.][\w-]+$/.test(i)&&(t.innerHTML=r.replace(n,(e,t,n)=>`${t}${n}${i}`),t.firstElementChild))for(let e=t.children,n=0,r=e.length;n<r;++n)e[0].remove()}get children(){switch(this.type){case 1:if(this.children_.parentNode!==this.container){this.children_=r.undefined;for(let e=this.container.childNodes,t=0,n=e.length;t<n;++t){const n=e[t];if("wholeText"in n!=0){this.children_=n;break}}}return this.children_.data;default:return this.children_}}set children(e){const t=[],n=[];let s=!1;switch(this.type){case 0:return;case 1:{if(!this.isInit&&e===this.children)return;const t=this.children_,n=t.data,i=e;if(t.data=i,i===n)return;return void this.element.dispatchEvent(new r.Event("change",{bubbles:!1,cancelable:!0}))}case 2:{const r=e,i=[];this.children_=i;const o=this.container.children;for(let e=0;e<r.length;++e){const t=r[e],c=o[e];t.element.parentNode!==this.container&&l(t),t.element!==c&&(t.element.parentNode!==this.container&&(this.scope(t),n.push(t)),this.container.insertBefore(t.element,c),s=!0),i.push(t)}for(let e=o.length;r.length<e--;){const e=o[r.length];a.has(e)&&(t.push(u(this.container.removeChild(e))),s=!0)}break}case 3:{const r=e,o=this.children_;for(const e of i.ObjectKeys(o)){const i=o[e],a=r[e];if(this.isInit||a!==i){if(a.element.parentNode!==this.container&&l(a),(this.isInit||a!==i&&a.element.parentNode!==i.element.parentNode)&&(this.scope(a),n.push(a),!this.isInit)){let e=0;(e=t.lastIndexOf(a))>-1&&c.splice(t,e,1),t.push(i),(e=n.lastIndexOf(i))>-1&&c.splice(n,e,1)}this.isPartialUpdate=!0,o[e]=r[e],this.isPartialUpdate=!1,s=!0}}break}}if(t.length){const e=new r.Event("disconnect",{bubbles:!1,cancelable:!0});for(const{element:n}of t)n.dispatchEvent(e)}if(n.length){const e=new r.Event("connect",{bubbles:!1,cancelable:!0});for(const{element:t}of n)t.dispatchEvent(e)}s&&this.element.dispatchEvent(new r.Event("change",{bubbles:!1,cancelable:!0}))}}},{"./identity":95,"./util/dom":97,"spica/alias":4,"spica/array":5,"spica/global":19}],97:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.define=n.element=n.text=n.svg=n.html=n.frag=n.shadow=void 0;const r=e("spica/global"),i=e("spica/alias"),s=e("spica/memoize");var o;function c(e){return r.document.createTextNode(e)}function a(e,t){const n=s.memoize(u,(e,t,n)=>`${t}:${n}`);return(r,i,s)=>{const o=r.includes("-")?u(e,t,r):n(e,t,r).cloneNode(!0);return d(i)?h(o,i):h(l(o,i),s)}}function u(e,t,n){if(!("createElement"in e))throw new Error("TypedDOM: Scoped custom elements are not supported on this browser.");switch(t){case"HTML":return e.createElement(n);case"SVG":return e.createElementNS("http://www.w3.org/2000/svg",n)}}function l(e,t){if(!t)return e;for(const n of i.ObjectKeys(t)){const r=t[n];switch(typeof r){case"string":e.setAttribute(n,r);continue;case"function":if(n.length<3)throw new Error(`TypedDOM: Attribute names for event listeners must have an event name but got "${n}".`);if("on"!==n.slice(0,2))throw new Error(`TypedDOM: Attribute names for event listeners must start with "on" but got "${n}".`);e.addEventListener(n.slice(2),r,{passive:["wheel","mousewheel","touchstart","touchmove"].includes(n.slice(2))});continue;case"object":e.removeAttribute(n);continue;default:continue}}return e}function h(e,t){switch(typeof t){case"undefined":return e;case"string":return h(e,[t])}if(!i.isArray(t)){if(!("length"in t))return h(e,[...t]);const n=[];for(let e=0,r=t.length;e<r;++e)n.push(t[e]);return h(e,n)}const n=e.firstChild?e.childNodes:[];let r=n.length;if(0===r)return e.append(...t),e;let s=0;e:for(let i=0;i<t.length;++i){if(s===r)return e.append(...t.slice(i)),e;const o=t[i];if("object"==typeof o&&11===o.nodeType){const t=o.childNodes.length;e.insertBefore(o,n[s]||null),s+=t,r+=t;continue}for(++s;r>t.length;){const e=n[s-1];if(p(e,o))continue e;e.remove(),--r}const a=n[s-1];p(a,o)||(r<t.length-i+s?(e.insertBefore("string"==typeof o?c(o):o,a),++r):e.replaceChild("string"==typeof o?c(o):o,a))}for(;s<r;)n[s].remove(),--r;return e}function d(e){return!!(null==e?void 0:e[r.Symbol.iterator])}function p(e,t){return"string"==typeof t?"wholeText"in e&&e.data===t:e===t}!function(e){e.shadows=new WeakMap,e.fragment=r.document.createDocumentFragment()}(o||(o={})),n.shadow=function e(t,i,s){if("string"==typeof t)return e(n.html(t),i,s);if(i&&!d(i))return e(t,r.undefined,i);const c=s===r.undefined?t.shadowRoot||o.shadows.get(t):"open"===s.mode?t.shadowRoot||r.undefined:o.shadows.get(t);return h(s&&"open"!==s.mode?c||o.shadows.set(t,t.attachShadow(s)).get(t):c||t.attachShadow(s||{mode:"open"}),c||i!=r.undefined?i:t.childNodes)},n.frag=function(e){return h(o.fragment.cloneNode(!0),e)},n.html=a(r.document,"HTML"),n.svg=a(r.document,"SVG"),n.text=c,n.element=a,n.define=function(e,t,n){return d(t)?h(e,t):h(l(e,t),n)}},{"spica/alias":4,"spica/global":19,"spica/memoize":24}],98:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.bind=n.delegate=n.wait=n.once=n.listen=n.currentTarget=void 0;const r=e("spica/global"),i=e("spica/promise"),s=e("spica/noop");function o(e,t,n,r=!1,i={}){return"string"==typeof n?c(e,t,n,r,{..."boolean"==typeof i?{capture:i}:i,once:!0}):a(e,t,n,{..."boolean"==typeof r?{capture:r}:r,once:!0})}function c(e,t,n,i,c={}){let u=s.noop;return a(e,n,e=>{var s,a;u();const l=e.target.shadowRoot?null===(s=e.composedPath()[0])||void 0===s?void 0:s.closest(t):null===(a=e.target)||void 0===a?void 0:a.closest(t);return l?u=o(l,n,i,c):r.undefined,e.returnValue},{...c,capture:!0})}function a(e,t,i,o=!1){e.addEventListener(t,a,o);let c=()=>void e.removeEventListener(t,a,o);return()=>void(c=c()||s.noop);function a(e){return n.currentTarget in e&&!e[n.currentTarget]?r.undefined:e[n.currentTarget]=e.currentTarget,i(e)}}n.currentTarget=Symbol.for("currentTarget"),n.listen=function(e,t,n,r=!1,i={}){return"string"==typeof n?c(e,t,n,r,i):a(e,t,n,r)},n.once=o,n.wait=function(e,t,n=!1,r={}){return new i.AtomicPromise(i=>"string"==typeof n?o(e,t,n,i,r):o(e,t,i,n))},n.delegate=c,n.bind=a},{"spica/global":19,"spica/noop":81,"spica/promise":83}],99:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.apply=void 0;const r=e("./dom");n.apply=function(e,t,n){const i=e.querySelectorAll(t);for(let e=0,t=i.length;e<t;++e)r.define(i[e],n);return i}},{"./dom":97}],100:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./layer/interface/service/gui");Object.defineProperty(n,"Pjax",{enumerable:!0,get:function(){return r.GUI}}),Object.defineProperty(n,"default",{enumerable:!0,get:function(){return r.GUI}});var i=e("./lib/router");Object.defineProperty(n,"router",{enumerable:!0,get:function(){return i.router}})},{"./layer/interface/service/gui":129,"./lib/router":139}],101:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.route=void 0;const r=e("../domain/router/api");var i=e("../domain/event/router");Object.defineProperty(n,"RouterEvent",{enumerable:!0,get:function(){return i.RouterEvent}}),Object.defineProperty(n,"RouterEventType",{enumerable:!0,get:function(){return i.RouterEventType}}),Object.defineProperty(n,"RouterEventSource",{enumerable:!0,get:function(){return i.RouterEventSource}});var s=e("../domain/data/config");Object.defineProperty(n,"Config",{enumerable:!0,get:function(){return s.Config}}),Object.defineProperty(n,"scope",{enumerable:!0,get:function(){return s.scope}}),n.route=function(e,t,n,i){return r.route(new r.RouterEntity(e,t,new r.RouterEntityState(n.process,n.scripts)),i)}},{"../domain/data/config":104,"../domain/event/router":106,"../domain/router/api":107}],102:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../domain/store/path");Object.defineProperty(n,"loadTitle",{enumerable:!0,get:function(){return r.loadTitle}}),Object.defineProperty(n,"savePosition",{enumerable:!0,get:function(){return r.savePosition}})},{"../domain/store/path":123}],103:[function(e,t,n){"use strict";function r(){window.history.replaceState({...window.history.state,title:document.title},document.title)}function i(){var e;window.history.replaceState({...window.history.state,position:{...null===(e=window.history.state)||void 0===e?void 0:e.position,top:window.pageYOffset,left:window.pageXOffset}},document.title)}Object.defineProperty(n,"__esModule",{value:!0}),n.savePjax=n.isTransitable=n.savePosition=n.loadPosition=n.saveTitle=n.loadTitle=void 0,r(),i(),n.loadTitle=function(){var e;return(null===(e=window.history.state)||void 0===e?void 0:e.title)||document.title},n.saveTitle=r,n.loadPosition=function(){var e;return(null===(e=window.history.state)||void 0===e?void 0:e.position)||{top:window.pageYOffset,left:window.pageXOffset}},n.savePosition=i,n.isTransitable=function(e){var t;return(null===(t=null==e?void 0:e.pjax)||void 0===t?void 0:t.transition)||!1},n.savePjax=function(){var e;window.history.replaceState({...window.history.state,pjax:{...null===(e=window.history.state)||void 0===e?void 0:e.pjax,transition:!0}},document.title)}},{}],104:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Config=void 0;const r=e("spica/assign");var i=e("./config/scope");Object.defineProperty(n,"scope",{enumerable:!0,get:function(){return i.scope}});n.Config=class{constructor(e){this.areas=["body"],this.link="a",this.form="form:not([method])",this.replace="",this.fetch={rewrite:e=>e,cache:(e,t)=>"",headers:new Headers,timeout:3e3,wait:0},this.update={rewrite:(e,t)=>void 0,head:"base, meta, link",css:!0,script:!0,ignore:"",ignores:{extension:'[href^="chrome-extension://"]',security:'[src*=".scr.kaspersky-labs.com/"]'},reload:"",logger:""},this.sequence=new s,this.progressbar="display:none;position:absolute;bottom:0;left:0;width:0;height:2px;background:rgb(40, 105, 255);",this.scope={},Object.defineProperties(this.update,{ignore:{enumerable:!1,set(e){this.ignores._=e},get(){return Object.keys(this.ignores).map(e=>this.ignores[e]).filter(e=>e.trim().length>0).join(",")}}}),r.extend(this,e),this.fetch.headers=new Headers(this.fetch.headers),Object.freeze(this),this.fetch.headers.set("X-Requested-With","XMLHttpRequest"),this.fetch.headers.set("X-Pjax","1")}filter(e){return e.matches(":not([target])")}fallback(e,t){if(e instanceof HTMLAnchorElement)window.location.assign(e.href);else if(e instanceof HTMLFormElement)window.location.assign(e.action);else{if(!(e instanceof Window))throw t;window.location.reload(!0)}}};class s{async fetch(){return"fetch"}async unload(){return"unload"}async content(){return"content"}async ready(){return"ready"}async load(){}}},{"./config/scope":105,"spica/assign":6}],105:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.scope=void 0;const r=e("../../../../lib/router"),i=e("../../../domain/data/config"),s=e("spica/sequence"),o=e("spica/maybe"),c=e("spica/assign");n.scope=function(e,t){const n={"/":{},...e.scope};return s.Sequence.from(Object.keys(n).sort().reverse()).dropWhile(e=>!r.compare(e,t.orig)&&!r.compare(e,t.dest)).take(1).filter(e=>!!r.compare(e,t.orig)&&r.compare(e,t.dest)).map(e=>n[e]).map(t=>t?o.Just(new i.Config(c.extend({},e,t))):o.Nothing).extract().reduce((e,t)=>t,o.Nothing)}},{"../../../../lib/router":139,"../../../domain/data/config":104,"spica/assign":6,"spica/maybe":23,"spica/sequence":84}],106:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.RouterEventLocation=n.RouterEventRequest=n.RouterEventMethod=n.RouterEventType=n.RouterEventSource=n.RouterEvent=void 0;const r=e("../../../lib/dom"),i=e("spica/url"),s=e("typed-dom");var o,c;n.RouterEvent=class{constructor(e){this.original=e,this.type=this.original.type.toLowerCase(),this.source=this.original[s.currentTarget],this.request=new a(this.source),this.location=new u(this.request.url),Object.freeze(this)}},function(e){e.Anchor=HTMLAnchorElement,e.Form=HTMLFormElement,e.Window=window.Window}(o=n.RouterEventSource||(n.RouterEventSource={})),function(e){e.Click="click",e.Submit="submit",e.Popstate="popstate"}(n.RouterEventType||(n.RouterEventType={})),function(e){e.GET="GET",e.POST="POST"}(c=n.RouterEventMethod||(n.RouterEventMethod={}));class a{constructor(e){this.source=e,this.method=(()=>{if(this.source instanceof o.Anchor)return c.GET;if(this.source instanceof o.Form)return this.source.method.toUpperCase()===c.POST?c.POST:c.GET;if(this.source instanceof o.Window)return c.GET;throw new TypeError})(),this.url=(()=>{if(this.source instanceof o.Anchor)return new i.URL(i.standardize(this.source.href));if(this.source instanceof o.Form)return this.source.method.toUpperCase()===c.GET?new i.URL(i.standardize(this.source.action.split(/[?#]/)[0]+`?${r.serialize(this.source)}`)):new i.URL(i.standardize(this.source.action.split(/[?#]/)[0]));if(this.source instanceof o.Window)return new i.URL(i.standardize(window.location.href));throw new TypeError})(),this.body=(()=>this.source instanceof o.Form&&this.method===c.POST?new FormData(this.source):null)(),Object.freeze(this)}}n.RouterEventRequest=a;class u{constructor(e){this.dest=e,this.orig=new i.URL(i.standardize(window.location.href)),Object.freeze(this)}}n.RouterEventLocation=u},{"../../../lib/dom":136,"spica/url":90,"typed-dom":93}],107:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.route=void 0;const r=e("./module/fetch"),i=e("./module/update"),s=e("./module/update/content"),o=e("../store/path"),c=e("spica/either");var a=e("./model/eav/entity");Object.defineProperty(n,"RouterEntity",{enumerable:!0,get:function(){return a.RouterEntity}}),Object.defineProperty(n,"RouterEntityState",{enumerable:!0,get:function(){return a.RouterEntityState}}),n.route=async function(e,t){return c.Right(void 0).bind(e.state.process.either).bind(()=>!function(e,t){return s.separate({src:e,dst:e},t).extract(()=>!1,()=>!0)}(t.document,e.config.areas)?c.Left(new Error("Failed to match areas.")):c.Right(void 0)).fmap(()=>r.fetch(e.event.request,e.config,e.state.process)).fmap(async n=>(await n).fmap(([n,r])=>i.update(e,n,r,{document:t.document,position:o.loadPosition})).extract(c.Left)).extract(c.Left)}},{"../store/path":123,"./model/eav/entity":108,"./module/fetch":110,"./module/update":112,"./module/update/content":114,"spica/either":15}],108:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.RouterEntityState=n.RouterEntity=void 0;n.RouterEntity=class{constructor(e,t,n){this.config=e,this.event=t,this.state=n,Object.freeze(this)}};n.RouterEntityState=class{constructor(e,t){this.process=e,this.scripts=t,Object.freeze(this)}}},{}],109:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FetchResponse=void 0;const r=e("../../../../../../lib/html"),i=e("spica/url");n.FetchResponse=class{constructor(e,t){if(this.url=e,this.xhr=t,this.header=(e=>this.xhr.getResponseHeader(e)),this.document=this.xhr.responseXML.cloneNode(!0),e.origin!==new i.URL(t.responseURL).origin)throw new Error("Redirected to another origin.");Object.defineProperty(this.document,"URL",{configurable:!0,enumerable:!0,value:e.reference,writable:!1}),r.fix(this.document),Object.freeze(this)}}},{"../../../../../../lib/html":138,"spica/url":90}],110:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.fetch=void 0;const r=e("../module/fetch/xhr"),i=e("spica/clock");n.fetch=async function({method:e,url:t,body:n},{fetch:{rewrite:s,cache:o,headers:c,timeout:a,wait:u},sequence:l},h){window.dispatchEvent(new Event("pjax:fetch"));const[d,p]=await Promise.all([l.fetch(void 0,{path:t.path,method:e,headers:c,body:n}),r.xhr(e,t,c,n,a,s,o,h),i.wait(u)]);return p.bind(h.either).fmap(e=>[e,d])}},{"../module/fetch/xhr":111,"spica/clock":11}],111:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.match_=n.xhr=void 0;const r=e("../../model/eav/value/fetch"),i=e("spica/promise"),s=e("spica/sequence"),o=e("spica/either"),c=e("spica/cache"),a=e("spica/url"),u=new c.Cache(99),l=new c.Cache(99);function h(e,t){return s.Sequence.intersect(s.Sequence.from(n(e||"").sort()),s.Sequence.from(n(t).sort()),(e,t)=>e.localeCompare(t)).take(1).extract().length>0;function n(e){return e.split(/\s*;\s*/).filter(e=>e.length>0)}}n.xhr=function(e,t,n,s,c,d,p,f){(n=new Headers(n)).set("Accept",n.get("Accept")||"text/html");const m=new a.URL(a.standardize(d(t.path)));"GET"===e&&l.has(m.path)&&Date.now()>l.get(m.path).expiry&&n.set("If-None-Match",n.get("If-None-Match")||l.get(m.path).etag);const v="GET"===e&&p(m.path,n)||void 0;return new i.AtomicPromise(i=>{if(v&&u.has(v))return i(o.Right(u.get(v)(t,m)));const d=new XMLHttpRequest;d.open(e,m.path,!0);for(const[e,t]of n)d.setRequestHeader(e,t);d.responseType="document",d.timeout=c,d.send(s),d.addEventListener("abort",()=>void i(o.Left(new Error("Failed to request a page by abort.")))),d.addEventListener("error",()=>void i(o.Left(new Error("Failed to request a page by error.")))),d.addEventListener("timeout",()=>void i(o.Left(new Error("Failed to request a page by timeout.")))),d.addEventListener("load",()=>void function(e,t){return o.Right(e).bind(e=>{const n=new a.URL(a.standardize(e.responseURL));switch(!0){case!e.responseURL:return o.Left(new Error("Failed to get the response URL."));case n.origin!==new a.URL(window.location.origin).origin:return o.Left(new Error("Redirected to another origin."));case!/2..|304/.test(`${e.status}`):return o.Left(new Error("Failed to validate the status of response."));case!e.response:return"GET"===t&&304===e.status&&l.has(n.path)?o.Right(l.get(n.path).xhr):o.Left(new Error("Failed to get the response body."));case!h(e.getResponseHeader("Content-Type"),"text/html"):return o.Left(new Error("Failed to validate the content type of response."));default:return o.Right(e)}})}(d,e).fmap(t=>{const n=new a.URL(a.standardize(t.responseURL));if("GET"===e){const e=new Map(t.getResponseHeader("Cache-Control")?t.getResponseHeader("Cache-Control").trim().split(/\s*,\s*/).filter(e=>e.length>0).map(e=>e.split("=").concat("")):[]);for(const r of new Set([m.path,n.path]))t.getResponseHeader("ETag")&&!e.has("no-store")?l.set(r,{etag:t.getResponseHeader("ETag"),expiry:e.has("max-age")&&!e.has("no-cache")&&Date.now()+1e3*+e.get("max-age")||0,xhr:t}):l.delete(r)}return(e,i)=>new r.FetchResponse(n.path===i.path?e:i.path!==m.path&&v?e:n,t)}).fmap(e=>(v&&u.set(v,e),e(t,m))).extract(e=>void i(o.Left(e)),e=>void i(o.Right(e)))),f.register(()=>void d.abort())})},n.match_=h},{"../../model/eav/value/fetch":109,"spica/cache":7,"spica/either":15,"spica/promise":83,"spica/sequence":84,"spica/url":90}],112:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.update=void 0;const r=e("../../event/router"),i=e("../module/update/blur"),s=e("../module/update/url"),o=e("../module/update/title"),c=e("../module/update/head"),a=e("../module/update/content"),u=e("../module/update/css"),l=e("../module/update/script"),h=e("../module/update/focus"),d=e("../module/update/scroll"),p=e("../../store/path"),f=e("spica/promise"),m=e("spica/either"),v=e("spica/hlist");n.update=function({event:e,config:t,state:n},b,y,g){const{process:w}=n,S={src:b.document,dst:g.document};return f.AtomicPromise.resolve(y).then(w.either).then(e=>e.bind(()=>a.separate(S,t.areas).extract(()=>m.Left(new Error("Failed to separate the areas.")),()=>e)).fmap(e=>(window.dispatchEvent(new Event("pjax:unload")),t.sequence.unload(e,{...b,url:b.url.reference})))).then(e=>m.Either.sequence(e)).then(w.promise).then(e=>e.bind(e=>a.separate(S,t.areas).fmap(([t])=>[e,t]).extract(()=>m.Left(new Error("Failed to separate the areas.")),w.either)).bind(([e,n])=>(t.update.rewrite(S.src,n),a.separate(S,t.areas).fmap(([,t])=>[e,t]).extract(()=>m.Left(new Error("Failed to separate the areas.")),w.either)))).then(w.promise).then(y=>y.fmap(([y,q])=>v.HList().unfold(()=>(i.blur(S.dst),p.savePjax(),s.url(new r.RouterEventLocation(b.url),S.src.title,e.type,e.source,t.replace),p.savePjax(),o.title(S),p.saveTitle(),c.head(S,t.update.head,t.update.ignore),w.either(a.content(S,q)).fmap(([e,t])=>[e,f.AtomicPromise.all(t)]))).unfold(async r=>(await r).fmap(async([r])=>{t.update.css&&u.css(S,t.update.ignore),g.document.dispatchEvent(new Event("pjax:content"));const i=await t.sequence.content(y,r),s=t.update.script?await l.script(S,n.scripts,t.update,10*Math.max(t.fetch.timeout,1e3),w):await w.either([[],f.AtomicPromise.resolve(w.either([]))]);return h.focus(e.type,S.dst),d.scroll(e.type,S.dst,{hash:e.location.dest.fragment,position:g.position}),p.savePosition(),g.document.dispatchEvent(new Event("pjax:ready")),[s.fmap(([e,t])=>[e,t.then(e=>e.extract())]),await t.sequence.ready(i)]}).fmap(e=>e.then(([e,t])=>e.fmap(e=>[e,t]))).extract(e=>f.AtomicPromise.resolve(m.Left(e)))).reverse())).then(w.promise).then(e=>e.fmap(([e,n])=>(f.AtomicPromise.all([e,n]).then(([e,n])=>e.bind(([,e])=>n.fmap(([[,n],r])=>void f.AtomicPromise.all([e,n]).then(w.either).then(e=>e.fmap(([e])=>(window.dispatchEvent(new Event("pjax:load")),void t.sequence.load(r,e))).extract(()=>void 0)))).extract(()=>void 0)),n))).then(e=>m.Either.sequence(e).then(e=>e.join())).then(e=>e.fmap(([e])=>e))}},{"../../event/router":106,"../../store/path":123,"../module/update/blur":113,"../module/update/content":114,"../module/update/css":115,"../module/update/focus":116,"../module/update/head":117,"../module/update/script":118,"../module/update/scroll":119,"../module/update/title":121,"../module/update/url":122,"spica/either":15,"spica/hlist":21,"spica/promise":83}],113:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.blur=void 0,n.blur=function(e){e===window.document&&e.activeElement!==e.body&&(e.activeElement.blur(),e.body.focus())}},{}],114:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n._wait=n._split=n.separate=n.content=void 0;const r=e("./script"),i=e("spica/promise"),s=e("spica/maybe"),o=e("spica/array"),c=e("typed-dom");function a(e){return(e.match(/(?:[^,\(\[]+|\(.*?\)|\[.*?\])+/g)||[]).map(e=>e.trim()).reduce((e,t)=>t?e.fmap(e=>o.push(e,[t])):s.Nothing,s.Just([]))}function u(e){return i.AtomicPromise.race([new i.AtomicPromise(t=>void c.once(e,"load",t)),new i.AtomicPromise(t=>void c.once(e,"abort",t)),new i.AtomicPromise(t=>void c.once(e,"error",t))])}n.content=function(e,t,n={replace:(e,t)=>void t.parentNode.replaceChild(e,t)}){return[t.map(e=>e.dst).reduce(o.push,[]),t.map(function(t){return t.src.map((n,r)=>({src:e.dst.importNode(t.src[r].cloneNode(!0),!0),dst:t.dst[r]})).map(e=>(!function(e){const t=[...e.src.querySelectorAll("script")].map(r.escape).reduce((e,t)=>()=>(e(),void t()),()=>void 0);n.replace(e.src,e.dst),t()}(e),[...e.src.querySelectorAll("img, iframe, frame")].map(u))).reduce(o.push,[])}).reduce(o.push,[])]},n.separate=function(e,t){return t.reduce((t,n)=>s.Maybe.mplus(t,function(e,t){return a(t).bind(t=>t.reduce((t,n)=>t.bind(t=>{const r={src:[...e.src.querySelectorAll(n)],dst:[...e.dst.querySelectorAll(n)]};return r.src.length>0&&r.src.length===r.dst.length?s.Just(o.push(t,[r])):s.Nothing}),s.Just([])))}(e,n).fmap(e=>[n,e])),s.Nothing)},n._split=a,n._wait=u},{"./script":118,"spica/array":5,"spica/maybe":23,"spica/promise":83,"typed-dom":93}],115:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.css=void 0;const r=e("./sync");n.css=function(e,t){const n='link[rel~="stylesheet"], style';return void["head","body"].map(t=>[e.src.querySelector(t),e.dst.querySelector(t)]).forEach(([e,t])=>void r.sync(r.pair(i(e),i(t),(e,t)=>e.outerHTML===t.outerHTML),t));function i(e){return[...e.querySelectorAll(n)].filter(e=>!t||!e.matches(t))}}},{"./sync":120}],116:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.focus=void 0;const r=e("../../../event/router");n.focus=function(e,t){switch(e){case r.RouterEventType.Click:case r.RouterEventType.Submit:return void[...t.querySelectorAll("[autofocus]")].slice(-1).filter(e=>e.closest("html")===window.document.documentElement&&e!==t.activeElement).forEach(e=>void e.focus());case r.RouterEventType.Popstate:return;default:throw new TypeError(e)}}},{"../../../event/router":106}],117:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.head=void 0;const r=e("./sync");n.head=function(e,t,n){return n+=t.includes("link")?', link[rel~="stylesheet"]':"",void r.sync(r.pair(i(e.src.head),i(e.dst.head),(e,t)=>e.outerHTML===t.outerHTML),e.dst.head);function i(e){return[...e.querySelectorAll(t)].filter(e=>!n||!e.matches(n))}}},{"./sync":120}],118:[function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.escape=n._evaluate=n._fetch=n.script=void 0;const o=e("../../../../../lib/error"),c=e("spica/promise"),a=e("spica/either"),u=e("spica/url"),l=e("spica/array"),h=e("spica/tuple"),d=e("spica/clock"),p=e("typed-dom");async function f(e,t){return e.hasAttribute("src")?"module"===e.type.toLowerCase()?a.Right([e,""]):c.AtomicPromise.race([window.fetch(e.src,{headers:new Headers({Accept:"application/javascript"}),integrity:e.integrity}),d.wait(t).then(()=>c.AtomicPromise.reject(new Error(`${e.src}: Timeout.`)))]).then(async t=>t.ok?a.Right([e,await t.text()]):e.matches("[src][async]")?b(e).then(()=>a.Right([e,""]),()=>a.Left(new Error(`${e.src}: ${t.statusText}`))):a.Left(new Error(t.statusText)),e=>a.Left(e)):a.Right([e,e.text])}function m(t,n,r,i,l,h){const d=!!(t=t.ownerDocument===document?t:document.importNode(t.cloneNode(!0),!0)).parentElement&&t.parentElement.matches(r.trim()||"_"),p=document.querySelector(d?t.parentElement.id?`#${t.parentElement.id}`:t.parentElement.tagName:"_")||document.body,f=v(t);p.appendChild(t),f(),!d&&t.remove();const m=c.AtomicPromise.resolve(l).then(function(){if(!h.alive)throw new o.FatalError("Expired.");if(t.matches('[type="module"][src]'))return c.AtomicPromise.resolve(Promise.resolve().then(()=>s(e(t.src)))).catch(e=>e.message.startsWith("Failed to load ")&&t.matches("[src][async]")?b(t).catch(()=>c.AtomicPromise.reject(e)):c.AtomicPromise.reject(e)).then(()=>(t.dispatchEvent(new Event("load")),a.Right(t)),e=>(t.dispatchEvent(new Event("error")),a.Left(new o.FatalError(e instanceof Error?e.message:e+""))));try{if(i.has(new u.URL(u.standardize(window.location.href)).reference))throw new o.FatalError("Expired.");return(0,eval)(n),t.hasAttribute("src")&&t.dispatchEvent(new Event("load")),c.AtomicPromise.resolve(a.Right(t))}catch(e){return t.hasAttribute("src")&&t.dispatchEvent(new Event("error")),c.AtomicPromise.resolve(a.Left(new o.FatalError(e instanceof Error?e.message:e+"")))}});return t.matches("[src][async]")?a.Right(m):a.Left(m)}function v(e){const t=e.hasAttribute("src")?e.getAttribute("src"):null,n=e.text;return e.removeAttribute("src"),e.text="",()=>(e.text=" ",e.text=n,"string"==typeof t?void e.setAttribute("src",t):void 0)}function b(e){return new u.URL(u.standardize(e.src)).origin===new u.URL(u.standardize(window.location.href)).origin?c.AtomicPromise.reject(new Error):(e=p.html("script",Object.values(e.attributes).reduce((e,{name:t,value:n})=>(e[t]=n,e),{}),[...e.childNodes]),new c.AtomicPromise((t,n)=>(e.addEventListener("load",()=>void t()),e.addEventListener("error",n),document.body.appendChild(e),void e.remove())))}n.script=function(e,t,n,r,i,s={fetch:f,evaluate:m}){const o=[...e.src.querySelectorAll("script")].filter(e=>!e.type||/(?:application|text)\/(?:java|ecma)script|module/i.test(e.type)).filter(e=>!e.matches(n.ignore.trim()||"_")).filter(e=>!e.hasAttribute("src")||!t.has(new u.URL(u.standardize(e.src)).reference)||e.matches(n.reload.trim()||"_")),{ss:d,as:p}=o.reduce((e,t)=>{switch(!0){case t.matches("[src][async], [src][defer]"):e.as.push(t);break;default:e.ss.push(t)}return e},{ss:[],as:[]});return c.AtomicPromise.all([c.AtomicPromise.all(v(d)).then(b),c.AtomicPromise.all(v(p)).then(b)]).then(async([e,t])=>e.fmap(async e=>(await e).fmap(([e,n])=>[e,n.then(async e=>t.fmap(async t=>(await t).fmap(([t,n])=>c.AtomicPromise.all([e,a.Right(t),n]).then(e=>e.reduce((e,t)=>e.bind(e=>t.fmap(t=>l.push(e,t)))))).extract(a.Left)).extract(a.Left))])).extract(a.Left));function v(e){return e.map(e=>s.fetch(e,r))}function b(e){return e.reduce((e,t)=>t.bind(()=>e),e.reduce((e,r)=>e.bind(i.either).bind(([e,o])=>r.fmap(([r,o])=>s.evaluate(r,o,n.logger,t,c.AtomicPromise.all(e),i)).bind(t=>t.extract(t=>a.Right(h.tuple(l.push(e,[t]),o)),t=>a.Right(h.tuple(e,l.push(o,[t])))))),a.Right([[],[]]))).fmap(([e,t])=>c.AtomicPromise.all(e).then(e=>a.Either.sequence(e)).then(e=>e.fmap(e=>h.tuple(e,Promise.all(t).then(e=>a.Either.sequence(e))))))}},n._fetch=f,n._evaluate=m,n.escape=v},{"../../../../../lib/error":137,"spica/array":5,"spica/clock":11,"spica/either":15,"spica/promise":83,"spica/tuple":88,"spica/url":90,"typed-dom":93}],119:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n._hash=n.scroll=void 0;const r=e("../../../event/router");function i(e,t,n={scrollToElement:e=>void e.scrollIntoView()}){const r=t.slice(1);if(0===r.length)return!1;const i=e.getElementById(r)||e.getElementsByName(r)[0];return!!i&&(n.scrollToElement(i),!0)}n.scroll=function(e,t,n,s={scrollToElement:e=>void e.scrollIntoView(),scrollToPosition:({top:e,left:t})=>void window.scrollTo(t,e),hash:i}){switch(e){case r.RouterEventType.Click:if(s.hash(t,n.hash,s))return;return void s.scrollToPosition({top:0,left:0});case r.RouterEventType.Submit:return void s.scrollToPosition({top:0,left:0});case r.RouterEventType.Popstate:return void s.scrollToPosition(n.position());default:throw new TypeError(e)}},n._hash=i},{"../../../event/router":106}],120:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.pair=n.sync=void 0;const r=e("spica/either"),i=e("spica/array");function s(e,t,n){t.map(t=>e.ownerDocument.importNode(t.cloneNode(!0),!0)).forEach(t=>void e.insertBefore(t,n))}function o(e){e.remove()}n.sync=function(e,t,n={before:s,remove:o}){return void e.forEach(([e,r])=>(n.before(function(e){return e?e.parentElement:t}(r),e.slice(-1).some(e=>!!r&&e.outerHTML===r.outerHTML)?e.slice(0,-1):e,r),r&&0===e.length?void n.remove(r):void 0))},n.pair=function(e,t,n){const s=function(e,t,n){return e.reduce((e,s)=>0===t.length?e.set(null,i.push(e.get(null)||[],[s])):t.reduce((e,t)=>e.bind(e=>!e.has(t)&&n(s,t)?(e.set(t,i.push(e.get(null)||[],[s])),e.delete(null),r.Left(e)):r.Right(e)),r.Right(e)).fmap(e=>e.set(null,i.push(e.get(null)||[],[s]))).extract(e=>e),new Map)}(e,t,n);return t.filter(e=>!s.has(e)).forEach(e=>void s.set(e,[])),[...s].map(([e,t])=>[t,e])}},{"spica/array":5,"spica/either":15}],121:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.title=void 0,n.title=function(e){e.dst.title=e.src.title}},{}],122:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n._isReplaceable=n._isRegisterable=n.url=void 0;const r=e("../../../event/router");function i(e,t){if(t.dest.reference===t.orig.reference)return!1;switch(e){case r.RouterEventType.Click:case r.RouterEventType.Submit:return!0;case r.RouterEventType.Popstate:return!1;default:throw new TypeError(e)}}function s(e,t,n){switch(e){case r.RouterEventType.Click:case r.RouterEventType.Submit:return t.matches(n.trim()||"_");case r.RouterEventType.Popstate:return!1;default:throw new TypeError(e)}}e("typed-dom").bind(document,"pjax:ready",()=>void window.history.replaceState(window.history.state,window.document.title)),n.url=function(e,t,n,r,o){switch(!0){case s(n,r,o):return void window.history.replaceState({},t,e.dest.reference);case i(n,e):return void window.history.pushState({},t,e.dest.reference);default:return}},n._isRegisterable=i,n._isReplaceable=s},{"../../../event/router":106,"typed-dom":93}],123:[function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("../../data/store/state"),n)},{"../../data/store/state":103}],124:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ClickView=void 0;const r=e("spica/coroutine"),i=e("typed-dom");n.ClickView=class extends r.Coroutine{constructor(e,t,n){super(async function*(){return this.finally(i.delegate(e,t,"click",e=>{e.currentTarget instanceof HTMLAnchorElement&&n(e)}))},{delay:!1})}}},{"spica/coroutine":13,"typed-dom":93}],125:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.NavigationView=void 0;const r=e("../../service/state/page"),i=e("../../../data/store/state"),s=e("spica/coroutine"),o=e("spica/url"),c=e("typed-dom");n.NavigationView=class extends s.Coroutine{constructor(e,t){super(async function*(){return this.finally(c.bind(e,"popstate",n=>{i.isTransitable(r.page.state)&&i.isTransitable(e.history.state)&&o.standardize(e.location.href)!==r.page.href&&t(n)}))},{delay:!1})}}},{"../../../data/store/state":103,"../../service/state/page":132,"spica/coroutine":13,"spica/url":90,"typed-dom":93}],126:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ScrollView=void 0;const r=e("../../service/state/page"),i=e("spica/coroutine"),s=e("spica/url"),o=e("spica/throttle"),c=e("typed-dom");n.ScrollView=class extends i.Coroutine{constructor(e,t){super(async function*(){return this.finally(c.bind(e,"scroll",o.debounce(100,n=>{s.standardize(e.location.href)===r.page.href&&t(n)}),{passive:!0}))},{delay:!1})}}},{"../../service/state/page":132,"spica/coroutine":13,"spica/throttle":87,"spica/url":90,"typed-dom":93}],127:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SubmitView=void 0;const r=e("spica/coroutine"),i=e("typed-dom");n.SubmitView=class extends r.Coroutine{constructor(e,t,n){super(async function*(){return this.finally(i.delegate(e,t,"submit",e=>{e.currentTarget instanceof HTMLFormElement&&n(e)}))},{delay:!1})}}},{"spica/coroutine":13,"typed-dom":93}],128:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.API=void 0;const r=e("./router"),i=e("./state/process"),s=e("../../data/store/state"),o=e("../../../lib/html"),c=e("spica/assign"),a=e("typed-dom");function u(e,t){const n=document.createElement("a");n.href=e,o.parse("").extract().body.appendChild(n),a.once(n,"click",t),a.once(n,"click",e=>void e.preventDefault()),n.click()}n.API=class{static assign(e,t,n={document:window.document,router:r.route}){let s;return u(e,e=>s=n.router(new r.Config(t),new r.RouterEvent(e),i.process,n)),s}static replace(e,t,n={document:window.document,router:r.route}){let s;return u(e,e=>s=n.router(new r.Config(c.extend({},t,{replace:"*"})),new r.RouterEvent(e),i.process,n)),s}static sync(e){e&&s.savePjax(),r.sync(i.process)}static pushURL(e,t,n=null){window.history.pushState(n,t,e),this.sync()}static replaceURL(e,t,n=window.history.state){const r=s.isTransitable(window.history.state);window.history.replaceState(n,t,e),this.sync(r)}}},{"../../../lib/html":138,"../../data/store/state":103,"./router":130,"./state/process":133,"spica/assign":6,"typed-dom":93}],129:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GUI=void 0;const r=e("./api"),i=e("../module/view/click"),s=e("../module/view/submit"),o=e("../module/view/navigation"),c=e("../module/view/scroll"),a=e("./router");e("./state/scroll-restoration");const u=e("./state/process"),l=e("../../application/store"),h=e("spica/supervisor"),d=e("spica/copropagator");class p extends r.API{constructor(e,t={document:window.document,router:a.route}){super(),this.option=e,this.io=t,this.view=new f(this.option,this.io),p.resources.clear(),p.resources.register("view",this.view)}assign(e){return r.API.assign(e,this.option,this.io)}replace(e){return r.API.replace(e,this.option,this.io)}}n.GUI=p,p.resources=new class extends h.Supervisor{};class f extends d.Copropagator{constructor(e,t){const n=new a.Config(e),r=e=>void t.router(n,new a.RouterEvent(e),u.process,t);super([new i.ClickView(t.document,n.link,r),new s.SubmitView(t.document,n.form,r),new o.NavigationView(window,r),new c.ScrollView(window,l.savePosition)])}}},{"../../application/store":102,"../module/view/click":124,"../module/view/navigation":125,"../module/view/scroll":126,"../module/view/submit":127,"./api":128,"./router":130,"./state/process":133,"./state/scroll-restoration":135,"spica/copropagator":12,"spica/supervisor":86}],130:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n._validate=n.sync=n.route=n.RouterEventSource=n.RouterEvent=n.Config=void 0;const r=e("../../application/router");Object.defineProperty(n,"Config",{enumerable:!0,get:function(){return r.Config}}),Object.defineProperty(n,"RouterEvent",{enumerable:!0,get:function(){return r.RouterEvent}}),Object.defineProperty(n,"RouterEventSource",{enumerable:!0,get:function(){return r.RouterEventSource}});const i=e("./state/page"),s=e("../service/state/env"),o=e("../../../lib/error"),c=e("../../application/store"),a=e("spica/url"),u=e("spica/cancellation"),l=e("spica/maybe"),h=e("spica/clock");function d(e,t,n){if(n.original.defaultPrevented)return!1;switch(n.type){case r.RouterEventType.Click:return o(e)&&(s=e,!(new a.URL(i.page.href).resource===s.resource&&""!==s.fragment))&&!p(e)&&!n.source.hasAttribute("download")&&!function(e){return e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey}(n.original)&&t.filter(n.source);case r.RouterEventType.Submit:return o(e);case r.RouterEventType.Popstate:return o(e)&&!p(e);default:return!1}var s;function o(e){return new a.URL(i.page.href).origin===e.origin}}function p(e){const t=new a.URL(i.page.href);return t.resource===e.resource&&t.fragment!==e.fragment}e("typed-dom").bind(window,"pjax:unload",()=>window.history.scrollRestoration="auto",!0),n.route=function(e,t,n,f){switch(t.type){case r.RouterEventType.Click:case r.RouterEventType.Submit:c.savePosition();break;case r.RouterEventType.Popstate:f.document.title=c.loadTitle()}return l.Just(0).guard(d(t.request.url,e,t)).bind(()=>r.scope(e,(({orig:e,dest:t})=>({orig:e.pathname,dest:t.pathname}))(t.location))).fmap(async e=>{t.original.preventDefault(),n.cast("",new Error("Canceled."));const c=new u.Cancellation,l=n.register("",e=>(l(),c.cancel(e),h.never)),[d]=await s.env;return window.history.scrollRestoration="manual",r.route(e,t,{process:c,scripts:d},f).then(e=>e.fmap(async([e,t])=>(l(),i.page.sync(),e.filter(e=>e.hasAttribute("src")).forEach(e=>void d.add(new a.URL(a.standardize(e.src)).reference)),void(await t).filter(e=>e.hasAttribute("src")).forEach(e=>void d.add(new a.URL(a.standardize(e.src)).reference)))).extract()).catch(n=>(l(),i.page.sync(),window.history.scrollRestoration="auto",c.alive||n instanceof o.FatalError?void e.fallback(t.source,n):void 0))}).extract(()=>{switch(n.cast("",new Error("Canceled.")),t.type){case r.RouterEventType.Click:case r.RouterEventType.Submit:return i.page.sync(),!1;case r.RouterEventType.Popstate:return p(t.location.dest)?(i.page.sync(),!1):(e.fallback(t.source,new Error("Disabled.")),i.page.sync(),!0)}},()=>!0)},n.sync=function(e){e.cast("",new Error("Canceled.")),i.page.sync()},n._validate=d},{"../../../lib/error":137,"../../application/router":101,"../../application/store":102,"../service/state/env":131,"./state/page":132,"spica/cancellation":8,"spica/clock":11,"spica/maybe":23,"spica/url":90,"typed-dom":93}],131:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.env=void 0;const r=e("./script");n.env=Promise.all([r.scripts,new Promise(e=>void setTimeout(e))])},{"./script":134}],132:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.page=void 0;const r=e("spica/global"),i=e("../../../data/store/state"),s=e("spica/url"),o=e("typed-dom");o.bind(r.window,"hashchange",()=>void n.page.sync()),o.bind(r.window,"popstate",()=>i.isTransitable(n.page.state)&&i.isTransitable(r.window.history.state)||void n.page.sync()),n.page=new class{constructor(){this.url=s.standardize(r.window.location.href),this.state_=r.window.history.state}get href(){return this.url}get state(){return this.state_}sync(){this.url=s.standardize(r.window.location.href),this.state_=r.window.history.state}}},{"../../../data/store/state":103,"spica/global":19,"spica/url":90,"typed-dom":93}],133:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.process=void 0;const r=e("spica/supervisor");n.process=new class extends r.Supervisor{}},{"spica/supervisor":86}],134:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.scripts=void 0;const r=e("spica/url"),i=e("typed-dom");n.scripts=new Set,i.bind(window,"pjax:unload",()=>void document.querySelectorAll("script[src]").forEach(e=>void n.scripts.add(new r.URL(r.standardize(e.src)).reference)))},{"spica/url":90,"typed-dom":93}],135:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),e("typed-dom").bind(window,"unload",()=>window.history.scrollRestoration="auto",!1)},{"typed-dom":93}],136:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.serialize=void 0,n.serialize=function(e){return[...e.elements].filter(e=>{if(!("name"in e))return!1;if(e.disabled)return!1;switch(e.tagName){case"INPUT":switch(e.type.toLowerCase()){case"checkbox":case"radio":return e.checked;case"submit":case"button":case"image":case"reset":case"file":return!1;default:return!0}case"SELECT":case"TEXTAREA":return!0;default:return!1}}).map(e=>[encodeURIComponent(t(e.name)),encodeURIComponent(t(e.value))].join("=")).join("&");function t(e){return e.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]?|[\uDC00-\uDFFF]/g,e=>2===e.length?e:"")}}},{}],137:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FatalError=void 0;class r extends Error{constructor(e){super(e)}}n.FatalError=r,Error.prototype.name="Error",r.prototype.name="FatalError"},{}],138:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n._fixNoscript=n.fix=n.parse=void 0;const r=e("spica/maybe"),i=e("spica/either");function s(e){o(e).forEach(([e,t])=>e.textContent=t.textContent)}function o(e){return[...e.querySelectorAll("noscript")].filter(e=>e.children.length>0).map(e=>{const t=e.cloneNode(!0);return t.textContent=e.innerHTML,[e,t]})}n.parse=[function(e){const t=(new DOMParser).parseFromString(e,"text/html");return s(t),t},function(e){const t=window.document.implementation.createHTMLDocument("");return t.open(),t.write(e),t.close(),s(t),t}].reduce((e,t)=>e.bind(()=>!function(e){try{const t='\n<html lang="en" class="html">\n  <head>\n    <link href="/">\n    <title>&amp;</title>\n    <noscript><style>/**/</style></noscript>\n  </head>\n  <body>\n    <noscript>noscript</noscript>\n    <a href="/"></a>\n    <script>document.head.remove();<\/script>\n    <img src="abc">\n  </body>\n</html>\n',n=e(t);switch(!1){case"&"===n.title:case!!n.querySelector('html.html[lang="en"]'):case!!n.querySelector("head > link").href:case!!n.querySelector("body > a").href:case!n.querySelector("head > noscript > *"):case"document.head.remove();"===n.querySelector("script").innerHTML:case n.querySelector("img").src.endsWith("abc"):case"<style>/**/</style>"===n.querySelector("head > noscript").textContent:case"noscript"===n.querySelector("body > noscript").textContent:throw void 0}return!0}catch(e){return!1}}(t)?e:i.Left(t)),i.Right(()=>r.Nothing)).extract(e=>t=>r.Just(e(t))),n.fix=s,n._fixNoscript=o},{"spica/either":15,"spica/maybe":23}],139:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n._match=n._expand=n.compare=n.router=void 0;const r=e("spica/url"),i=e("spica/sequence"),s=e("spica/curry"),o=e("spica/flip"),c=e("spica/memoize");function a(e,t){const n=/\/|[^/]+\/?/g,r=/\/$/;return i.Sequence.zip(i.Sequence.from(u(e)),i.Sequence.cycle([t])).map(([e,t])=>[e.match(n)||[],e.match(r)?t.match(n)||[]:t.replace(r,"").match(n)||[]]).filter(([e,t])=>e.length<=t.length&&0===i.Sequence.zip(i.Sequence.from(e),i.Sequence.from(t)).dropWhile(([e,t])=>l(e,t)).take(1).extract().length).take(1).extract().length>0}n.router=function(e){return t=>{const{path:n,pathname:c}=new r.URL(r.standardize(t));return i.Sequence.from(Object.keys(e).filter(e=>"/"===e[0]).sort().reverse()).filter(s.curry(o.flip(a))(c)).map(t=>e[t]).take(1).extract().pop().call(e,n)}},n.compare=a;const u=c.memoize(e=>{if(e.match(/\*\*|[\[\]]/))throw new Error(`Invalid pattern: ${e}`);return""===e?[e]:i.Sequence.from(e.match(/{[^{}]*}|.[^{]*/g)).map(e=>e.match(/^{[^{}]*}$/)?e.slice(1,-1).split(","):[e]).mapM(i.Sequence.from).map(e=>e.join("")).bind(t=>t===e?i.Sequence.from([t]):i.Sequence.from(u(t))).unique().extract()});n._expand=u;const l=c.memoize((e,t)=>{return("."!==t[0]||![..."?*"].includes(e[0]))&&function e(t,n){const[r="",...s]=[...t];const[o="",...c]=[...n];switch(r){case"":return""===o;case"?":return""!==o&&"/"!==o&&e(s.join(""),c.join(""));case"*":return"/"===o?e(s.join(""),n):i.Sequence.zip(i.Sequence.cycle([s.join("")]),i.Sequence.from(n).tails().map(e=>e.join(""))).filter(([t,n])=>e(t,n)).take(1).extract().length>0;default:return o===r&&e(s.join(""),c.join(""))}}(function e(t){const n=t.replace(/\*(\?+)\*?/g,"$1*");return n===t?n:e(n)}(e),t)},(e,t)=>`${e} ${t}`);n._match=l},{"spica/curry":14,"spica/flip":17,"spica/memoize":24,"spica/sequence":84,"spica/url":90}],"pjax-api":[function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./src/export");Object.defineProperty(n,"default",{enumerable:!0,get:function(){return s.default}}),i(e("./src/export"),n)},{"./src/export":100}]},{},[1,2,3,"pjax-api"]),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports&&(module.exports=t())}("undefined"!=typeof self&&self,function(){return require("pjax-api")});